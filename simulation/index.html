
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for BitePy: a Python high-frequency intraday trading engine for simulating battery strategies on the European market using dynamic programming.">
      
      
      
        <link rel="canonical" href="https://dschaurecker.github.io/bitepy/simulation/">
      
      
        <link rel="prev" href="../data/">
      
      
        <link rel="next" href="../results/">
      
      
        
      
      
      <link rel="icon" href="../assets/bite_logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Simulation - BitePy - A Python Battery Intraday Trading Engine</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-20FJGP4HBS"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-20FJGP4HBS",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-20FJGP4HBS",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#simulation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="BitePy - A Python Battery Intraday Trading Engine" class="md-header__button md-logo" aria-label="BitePy - A Python Battery Intraday Trading Engine" data-md-component="logo">
      
  <img src="../assets/bite_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BitePy - A Python Battery Intraday Trading Engine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Simulation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="BitePy - A Python Battery Intraday Trading Engine" class="md-nav__button md-logo" aria-label="BitePy - A Python Battery Intraday Trading Engine" data-md-component="logo">
      
  <img src="../assets/bite_logo.png" alt="logo">

    </a>
    BitePy - A Python Battery Intraday Trading Engine
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Preprocessing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Simulation
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Simulation
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Simulation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.add_bin_to_orderqueue" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_bin_to_orderqueue
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.add_df_to_orderqueue" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_df_to_orderqueue
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_data_bins_for_each_day" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_data_bins_for_each_day
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_last_order_placement_time" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_last_order_placement_time
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_last_order_placement_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_last_order_placement_time--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_last_order_placement_time--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_last_order_placement_time--example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_limit_order_book_state
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_limit_order_book_state">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--query-order-book-state-with-default-max_action-inject_max-withdraw_max" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query order book state with default max_action (inject_max + withdraw_max)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--query-with-custom-max_action" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query with custom max_action
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--filter-to-see-sell-orders-for-a-specific-product" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filter to see sell orders for a specific product
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--see-the-best-cheapest-sell-price" class="md-nav__link">
    <span class="md-ellipsis">
      
        See the best (cheapest) sell price
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--filter-to-see-only-forecast-orders" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filter to see only forecast orders
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_matches" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_limit_order_matches
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_logs" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_logs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_next_order_start_time" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_next_order_start_time
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_next_order_start_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_next_order_start_time--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_next_order_start_time--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_next_order_start_time--example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_transactions" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_transactions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.group_transactions" class="md-nav__link">
    <span class="md-ellipsis">
      
        group_transactions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.has_orders_remaining" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_orders_remaining
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="has_orders_remaining">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.has_orders_remaining--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.has_stopped_at_stop_time" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_stopped_at_stop_time
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="has_stopped_at_stop_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.has_stopped_at_stop_time--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.has_stopped_at_stop_time--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.has_stopped_at_stop_time--example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.print_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        print_parameters
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.reached_end_of_day" class="md-nav__link">
    <span class="md-ellipsis">
      
        reached_end_of_day
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="reached_end_of_day">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.reached_end_of_day--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.reached_end_of_day--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.reached_end_of_day--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.reached_end_of_day--example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.return_vol_price_pairs" class="md-nav__link">
    <span class="md-ellipsis">
      
        return_vol_price_pairs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.run" class="md-nav__link">
    <span class="md-ellipsis">
      
        run
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.run_one_day" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_one_day
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.set_stop_time" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_stop_time
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="set_stop_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.set_stop_time--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.set_stop_time--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.solve" class="md-nav__link">
    <span class="md-ellipsis">
      
        solve
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="solve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.solve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.solve--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.solve--example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.submit_limit_orders" class="md-nav__link">
    <span class="md-ellipsis">
      
        submit_limit_orders
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.transform_lob_to_levels" class="md-nav__link">
    <span class="md-ellipsis">
      
        transform_lob_to_levels
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="transform_lob_to_levels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.transform_lob_to_levels--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.transform_lob_to_levels--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../results/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Results Postprocessing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/dschaurecker/bitepy/issues" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Issues [Github]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/dschaurecker/bitepy/tree/main" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Source [Github]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/dschaurecker/bitepy/blob/main/LICENSE" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Licence [Github]
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Simulation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.add_bin_to_orderqueue" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_bin_to_orderqueue
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.add_df_to_orderqueue" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_df_to_orderqueue
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_data_bins_for_each_day" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_data_bins_for_each_day
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_last_order_placement_time" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_last_order_placement_time
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_last_order_placement_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_last_order_placement_time--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_last_order_placement_time--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_last_order_placement_time--example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_limit_order_book_state
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_limit_order_book_state">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--query-order-book-state-with-default-max_action-inject_max-withdraw_max" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query order book state with default max_action (inject_max + withdraw_max)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--query-with-custom-max_action" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query with custom max_action
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--filter-to-see-sell-orders-for-a-specific-product" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filter to see sell orders for a specific product
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--see-the-best-cheapest-sell-price" class="md-nav__link">
    <span class="md-ellipsis">
      
        See the best (cheapest) sell price
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_book_state--filter-to-see-only-forecast-orders" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filter to see only forecast orders
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_limit_order_matches" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_limit_order_matches
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_logs" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_logs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_next_order_start_time" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_next_order_start_time
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_next_order_start_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_next_order_start_time--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_next_order_start_time--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_next_order_start_time--example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.get_transactions" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_transactions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.group_transactions" class="md-nav__link">
    <span class="md-ellipsis">
      
        group_transactions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.has_orders_remaining" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_orders_remaining
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="has_orders_remaining">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.has_orders_remaining--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.has_stopped_at_stop_time" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_stopped_at_stop_time
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="has_stopped_at_stop_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.has_stopped_at_stop_time--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.has_stopped_at_stop_time--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.has_stopped_at_stop_time--example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.print_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        print_parameters
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.reached_end_of_day" class="md-nav__link">
    <span class="md-ellipsis">
      
        reached_end_of_day
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="reached_end_of_day">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.reached_end_of_day--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.reached_end_of_day--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.reached_end_of_day--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.reached_end_of_day--example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.return_vol_price_pairs" class="md-nav__link">
    <span class="md-ellipsis">
      
        return_vol_price_pairs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.run" class="md-nav__link">
    <span class="md-ellipsis">
      
        run
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.run_one_day" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_one_day
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.set_stop_time" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_stop_time
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="set_stop_time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.set_stop_time--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.set_stop_time--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.solve" class="md-nav__link">
    <span class="md-ellipsis">
      
        solve
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="solve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.solve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.solve--notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.solve--example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.submit_limit_orders" class="md-nav__link">
    <span class="md-ellipsis">
      
        submit_limit_orders
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bitepy.Simulation.transform_lob_to_levels" class="md-nav__link">
    <span class="md-ellipsis">
      
        transform_lob_to_levels
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="transform_lob_to_levels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.transform_lob_to_levels--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitepy.Simulation.transform_lob_to_levels--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="simulation">Simulation</h1>
<p>The <code>Simulation</code> class enables users to initialize simulation instances, set parameters, load the preprocessed LOB Data into the simulation, run the simulation, and return results.
Conceptually, you first set the parameters of the simulation (battery, dynamic programming, and simulation settings), then decide which days of LOB data to feed, before subsequently running the simulation for the desired amount of time. Order book traversals and optimizations happen in C++, while pre-/post-processing and settings are done in Python. Results are returned as Pandas dataframes and can be fed into the post-processing described below.</p>


<div class="doc doc-object doc-class">



<a id="bitepy.Simulation"></a>
    <div class="doc doc-contents first">










              <details class="mkdocstrings-source">
                <summary>Source code in <code>bitepy/simulation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  26</span>
<span class="normal">  27</span>
<span class="normal">  28</span>
<span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Simulation</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
                 <span class="n">trading_start_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">storage_max</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span>
                 <span class="n">lin_deg_cost</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span>
                 <span class="n">loss_in</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
                 <span class="n">loss_out</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
                 <span class="n">trading_fee</span><span class="o">=</span><span class="mf">0.09</span><span class="p">,</span>
                 <span class="n">num_stor_states</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                 <span class="n">trading_delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">tec_delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">fixed_solve_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">solve_frequency</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
                 <span class="n">withdraw_max</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span>
                 <span class="n">inject_max</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span>
                 <span class="n">log_transactions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">only_traverse_lob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">cycle_limit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">min_hot_queue_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,):</span>
                <span class="c1">#  forecast_horizon_start=10*60,</span>
                <span class="c1">#  forecast_horizon_end=75):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a Simulation instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            start_date (pd.Timestamp): The start datetime of the simulation, i.e. which products are loaded into the simulation. Must be timezone aware.</span>
<span class="sd">            end_date (pd.Timestamp): The end datetime of the simulation, i.e. which products are loaded into the simulation. Must be timezone aware.</span>
<span class="sd">            trading_start_date (pd.Timestamp, optional): The start datetime of the trading, i.e. when the trading starts. Must be timezone aware. If None, the trading starts at the same time as the start_date.</span>
<span class="sd">            storage_max (float, optional): The maximum storage capacity of the storage unit (MWh). Default is 10.0.</span>
<span class="sd">            lin_deg_cost (float, optional): The linear degradation cost of the storage unit (/MWh). Default is 4.0.</span>
<span class="sd">            loss_in (float, optional): The injection efficiency of the storage unit (0-1]. Default is 0.95.</span>
<span class="sd">            loss_out (float, optional): The withdrawal efficiency of the storage unit (0-1]. Default is 0.95.</span>
<span class="sd">            trading_fee (float, optional): The trading fee for the exchange (/MWh). Default is 0.09.</span>
<span class="sd">            num_stor_states (int, optional): The number of storage states for dynamic programming. Default is 11.</span>
<span class="sd">            trading_delay (int, optional): The trading delay of the storage unit, i.e., when to start trading all new products after gate opening. (min, &gt;= 0 and &lt; 480 mins (8 hours)). Default is 0.</span>
<span class="sd">            tec_delay (int, optional): The technical delay of the storage unit (ms, &gt;= 0). Default is 0.</span>
<span class="sd">            fixed_solve_time (int, optional): The fixed solve time for dynamic programming (ms, &gt;= 0 or -1 for realistic solve times). Default is 0.</span>
<span class="sd">            solve_frequency (float, optional): The frequency at which the dynamic programming solver is run (min). Default is 0.0.</span>
<span class="sd">            withdraw_max (float, optional): The maximum withdrawal power of the storage unit (MW). Default is 5.0.</span>
<span class="sd">            inject_max (float, optional): The maximum injection power of the storage unit (MW). Default is 5.0.</span>
<span class="sd">            log_transactions (bool, optional): If True, we run the simulation only to log transactions data of the market, no optimization is performed. Default is False.</span>
<span class="sd">            only_traverse_lob: Whether to only traverse the LOB and not call any DP solves. (bool, default: False)</span>
<span class="sd">            cycle_limit: The limit on the number of cycles per Berlin-time day. Setting it comes at a cost in terms of solve time. (float, &gt; 0). Default is None, where no cycle limit is enforced.</span>
<span class="sd">            min_hot_queue_size: The minimum number of orders to keep in the hot cache for each order queue. (int, &gt; 0, or -1 to disable and use only volume-based caching, default: -1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># forecast_horizon_start (int, optional): The start of the forecast horizon (min). Default is 600.</span>
        <span class="c1"># forecast_horizon_end (int, optional): The end of the forecast horizon (min). Default is 75.</span>

        <span class="c1"># write all the assertions</span>
        <span class="k">if</span> <span class="n">start_date</span> <span class="o">&gt;=</span> <span class="n">end_date</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;start_date must be before end_date&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trading_start_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trading_start_date</span> <span class="o">=</span> <span class="n">start_date</span>
        <span class="k">if</span> <span class="n">trading_start_date</span> <span class="o">&gt;=</span> <span class="n">end_date</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;trading_start_date must be before end_date&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">storage_max</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;storage_max must be &gt;= 0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lin_deg_cost</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;lin_deg_cost must be &gt;= 0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">loss_in</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">loss_in</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;loss_in must be in [0, 1]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">loss_out</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">loss_out</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;loss_out must be in [0,1]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trading_fee</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;trading_fee must be &gt;= 0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_stor_states</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_stor_states must be &gt; 0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tec_delay</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tec_delay must be &gt;= 0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fixed_solve_time</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fixed_solve_time</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;fixed_solve_time must be &gt;= 0 (or -1 for realistic solve times)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">solve_frequency</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;solve_frequency must be &gt;= 0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">withdraw_max</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;withdraw_max must be &gt; 0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inject_max</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;inject_max must be &gt; 0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trading_delay</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">trading_delay</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="o">*</span><span class="mi">60</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;trading_delay must be &gt;= 0 and &lt; 480 mins (8 hours)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cycle_limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cycle_limit</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cycle_limit must be &gt; 0 if provided&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">min_hot_queue_size</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">min_hot_queue_size</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;min_hot_queue_size must be &gt; 0 or -1 (to disable)&quot;</span><span class="p">)</span>
        <span class="c1"># if forecast_horizon_start &lt; 0:</span>
        <span class="c1">#     raise ValueError(&quot;forecast_horizon_start must be &gt;= 0&quot;)</span>
        <span class="c1"># if forecast_horizon_end &lt; 0:</span>
        <span class="c1">#     raise ValueError(&quot;forecast_horizon_end must be &gt;= 0&quot;)</span>
        <span class="c1"># if forecast_horizon_start &lt;= forecast_horizon_end:</span>
        <span class="c1">#     raise ValueError(&quot;forecast_horizon_start must larger than forecast_horizon_end&quot;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span> <span class="o">=</span> <span class="n">Simulation_cpp</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">storageMax</span> <span class="o">=</span> <span class="n">storage_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">linDegCost</span> <span class="o">=</span> <span class="n">lin_deg_cost</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">lossIn</span> <span class="o">=</span> <span class="n">loss_in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">lossOut</span> <span class="o">=</span> <span class="n">loss_out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingFee</span> <span class="o">=</span> <span class="n">trading_fee</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">numStorStates</span> <span class="o">=</span> <span class="n">num_stor_states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pingDelay</span> <span class="o">=</span> <span class="n">tec_delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">fixedSolveTime</span> <span class="o">=</span> <span class="n">fixed_solve_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dpFreq</span> <span class="o">=</span> <span class="n">solve_frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">withdrawMax</span> <span class="o">=</span> <span class="n">withdraw_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">injectMax</span> <span class="o">=</span> <span class="n">inject_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">minuteDelay</span> <span class="o">=</span> <span class="n">trading_delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">logTransactions</span> <span class="o">=</span> <span class="n">log_transactions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">onlyTraverseLOB</span> <span class="o">=</span> <span class="n">only_traverse_lob</span>
        <span class="k">if</span> <span class="n">cycle_limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cycleLimit</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cycle_limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">minHotQueueSize</span> <span class="o">=</span> <span class="n">min_hot_queue_size</span>
        <span class="c1"># self._sim_cpp.params.foreHorizonStart = forecast_horizon_start</span>
        <span class="c1"># self._sim_cpp.params.foreHorizonEnd = forecast_horizon_end</span>

        <span class="c1"># Set start and end date</span>
        <span class="k">if</span> <span class="n">start_date</span> <span class="o">&gt;=</span> <span class="n">end_date</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;start_date must be before end_date&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start_date</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;start_date must be timezone aware&quot;</span><span class="p">)</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startMonth</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">month</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startDay</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startYear</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startHour</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">hour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startMinute</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">minute</span>
        <span class="k">if</span> <span class="n">end_date</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;end_date must be timezone aware&quot;</span><span class="p">)</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endMonth</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">month</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endDay</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endYear</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endHour</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">hour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endMinute</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">minute</span>

        <span class="c1"># Set trading start date</span>
        <span class="k">if</span> <span class="n">trading_start_date</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;trading_start_date must be timezone aware&quot;</span><span class="p">)</span>
        <span class="n">trading_start_date</span> <span class="o">=</span> <span class="n">trading_start_date</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartMonth</span> <span class="o">=</span> <span class="n">trading_start_date</span><span class="o">.</span><span class="n">month</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartDay</span> <span class="o">=</span> <span class="n">trading_start_date</span><span class="o">.</span><span class="n">day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartYear</span> <span class="o">=</span> <span class="n">trading_start_date</span><span class="o">.</span><span class="n">year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartHour</span> <span class="o">=</span> <span class="n">trading_start_date</span><span class="o">.</span><span class="n">hour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartMinute</span> <span class="o">=</span> <span class="n">trading_start_date</span><span class="o">.</span><span class="n">minute</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_bin_to_orderqueue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_data</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an order binary file to the simulation&#39;s order queue.</span>

<span class="sd">        Args:</span>
<span class="sd">            bin_data (str): The path to the order binary file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">addOrderQueueFromBin</span><span class="p">(</span><span class="n">bin_data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_df_to_orderqueue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a DataFrame of orders to the simulation&#39;s order queue.</span>

<span class="sd">        The DataFrame must have the same columns as the saved CSV files, with timestamps in UTC</span>
<span class="sd">        (seconds and milliseconds).</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pd.DataFrame): A DataFrame containing the orders to be added.</span>

<span class="sd">        Processing Steps:</span>
<span class="sd">            - Validate that the timestamp columns (&#39;start&#39;, &#39;transaction&#39;, &#39;validity&#39;) are timezone aware.</span>
<span class="sd">            - Ensure that all timestamps are in the same timezone.</span>
<span class="sd">            - Convert all timestamps to UTC and format them in ISO 8601.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;validity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All timestamps of input df must be timezone aware&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="ow">and</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;validity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All timestamps of input df must be in the same timezone&quot;</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;validity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;validity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%SZ&#39;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Z&#39;</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;validity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;validity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Z&#39;</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">initials</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;initial&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">sides</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">starts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">transactions</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">validities</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;validity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">prices</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">quantities</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">addOrderQueueFromPandas</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">initials</span><span class="p">,</span> <span class="n">sides</span><span class="p">,</span> <span class="n">starts</span><span class="p">,</span> <span class="n">transactions</span><span class="p">,</span> <span class="n">validities</span><span class="p">,</span> <span class="n">prices</span><span class="p">,</span> <span class="n">quantities</span><span class="p">)</span>

    <span class="c1"># def add_forecast_from_df(self, df: pd.DataFrame):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Add forecast data from a DataFrame to the simulation.</span>

    <span class="c1">#     The DataFrame must contain the following columns:</span>
    <span class="c1">#         - creation_time: The time when the forecast was created (timezone aware, up to millisecond precision).</span>
    <span class="c1">#         - delivery_start: The start time of the delivery period (timezone aware).</span>
    <span class="c1">#         - sell_price: The price at which the optimization will try to sell (/MWh).</span>
    <span class="c1">#         - buy_price: The price at which the optimization will try to buy (/MWh).</span>

    <span class="c1">#     Args:</span>
    <span class="c1">#         df (pd.DataFrame): A DataFrame containing the forecast data.</span>

    <span class="c1">#     Processing Steps:</span>
    <span class="c1">#         - Validate that the &#39;creation_time&#39; and &#39;delivery_start&#39; columns are timezone aware and identical.</span>
    <span class="c1">#         - Convert the timestamps to UTC and format them in ISO 8601.</span>
    <span class="c1">#         - Pass the data to the simulation.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     if (df[&quot;creation_time&quot;].dt.tz is None and df[&quot;delivery_start&quot;].dt.tz is None):</span>
    <span class="c1">#         raise ValueError(&quot;All timestamps of input df must be timezone aware&quot;)</span>
    <span class="c1">#     if not (df[&quot;creation_time&quot;].dt.tz == df[&quot;delivery_start&quot;].dt.tz):</span>
    <span class="c1">#         raise ValueError(&quot;All timestamps of input df must be in the same timezone&quot;)</span>

    <span class="c1">#     df[&quot;creation_time&quot;] = df[&quot;creation_time&quot;].dt.tz_convert(&quot;UTC&quot;)</span>
    <span class="c1">#     df[&quot;delivery_start&quot;] = df[&quot;delivery_start&quot;].dt.tz_convert(&quot;UTC&quot;)</span>

    <span class="c1">#     df[&quot;creation_time&quot;] = df[&quot;creation_time&quot;].dt.tz_localize(None).dt.strftime(&#39;%Y-%m-%dT%H:%M:%S.%f&#39;).str[:-3] + &#39;Z&#39;</span>
    <span class="c1">#     df[&quot;delivery_start&quot;] = df[&quot;delivery_start&quot;].dt.tz_localize(None).dt.strftime(&#39;%Y-%m-%dT%H:%M:%SZ&#39;)</span>

    <span class="c1">#     creation_time = df[&quot;creation_time&quot;].to_numpy(dtype=&#39;str&#39;).tolist()</span>
    <span class="c1">#     delivery_start = df[&quot;delivery_start&quot;].to_numpy(dtype=&#39;str&#39;).tolist()</span>
    <span class="c1">#     buy_price = df[&quot;buy_price&quot;].to_numpy(dtype=np.float64).tolist()</span>
    <span class="c1">#     sell_price = df[&quot;sell_price&quot;].to_numpy(dtype=np.float64).tolist()</span>

    <span class="c1">#     self._sim_cpp.loadForecastMapFromPandas(creation_time, delivery_start, buy_price, sell_price)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_data_bins_for_each_day</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a list of file paths for binary order book data for each day within a date range.</span>

<span class="sd">        Args:</span>
<span class="sd">            base_path (str): The base directory path where the binary files are stored.</span>
<span class="sd">            start_date (pd.Timestamp): The start date of the range.</span>
<span class="sd">            end_date (pd.Timestamp): The end date of the range.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of file paths for each day&#39;s binary order book file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># convert dates to utc time</span>
        <span class="n">start_date_berlin</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;Europe/Berlin&#39;</span><span class="p">)</span> <span class="c1"># convert to tz in which the lob files are segemented</span>
        <span class="n">end_date_berlin</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;Europe/Berlin&#39;</span><span class="p">)</span> <span class="c1"># convert to tz in which the lob files are segemented</span>

        <span class="c1"># round up to midnight</span>
        <span class="n">end_date_berlin_round_up</span> <span class="o">=</span> <span class="n">end_date_berlin</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">59</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">59</span><span class="p">)</span>

        <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">base_path</span> <span class="o">+=</span> <span class="s2">&quot;orderbook_&quot;</span>

        <span class="c1"># Generate paths for each day within the date range</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">current_date</span> <span class="o">=</span> <span class="n">start_date_berlin</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># include the day before the start date to ensure that all orders submitted with delivery on first day are included</span>
        <span class="k">while</span> <span class="n">current_date</span> <span class="o">&lt;</span> <span class="n">end_date_berlin_round_up</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_path</span><span class="si">}{</span><span class="n">current_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.bin&quot;</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">current_date</span> <span class="o">+=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">paths</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the simulation using binary data files.</span>

<span class="sd">        The files must be named as: orderbook_YYYY-MM-DD.bin.</span>

<span class="sd">        Args:</span>
<span class="sd">            data_path (str): The directory containing the binary data files.</span>
<span class="sd">            verbose (bool, optional): If True, display progress logs. Default is True.</span>

<span class="sd">        Processing Steps:</span>
<span class="sd">            - Retrieve the list of binary file paths for the simulation period.</span>
<span class="sd">            - Iterate through each day&#39;s data, add the file to the order queue, and run the simulation for that day.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame containing the transactions if log_transactions is True, otherwise None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startYear</span><span class="p">,</span>
                                  <span class="n">month</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startMonth</span><span class="p">,</span>
                                  <span class="n">day</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startDay</span><span class="p">,</span>
                                  <span class="n">hour</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startHour</span><span class="p">,</span>
                                  <span class="n">minute</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startMinute</span><span class="p">,</span>
                                  <span class="n">tz</span><span class="o">=</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endYear</span><span class="p">,</span>
                                <span class="n">month</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endMonth</span><span class="p">,</span>
                                <span class="n">day</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endDay</span><span class="p">,</span>
                                <span class="n">hour</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endHour</span><span class="p">,</span>
                                <span class="n">minute</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endMinute</span><span class="p">,</span>
                                <span class="n">tz</span><span class="o">=</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
        <span class="n">lob_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_bins_for_each_day</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>

        <span class="n">transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">num_days</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lob_paths</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The simulation will iterate over&quot;</span><span class="p">,</span> <span class="n">num_days</span><span class="p">,</span> <span class="s2">&quot;files.&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">num_days</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Simulated Days&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lob_paths</span><span class="p">):</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Currently simulating </span><span class="si">{</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> ... &quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_bin_to_orderqueue</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_one_day</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">lob_paths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">logTransactions</span><span class="p">:</span>
                    <span class="n">transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">transactions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_transactions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_transactions</span><span class="p">())])</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulation finished.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">logTransactions</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">transactions</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">transactions</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">group_transactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transactions</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Group transactions by timestamp and delivery hour, calculating volume-weighted average prices.</span>

<span class="sd">        Args:</span>
<span class="sd">            transactions (pd.DataFrame): A DataFrame containing the transactions to be grouped.</span>

<span class="sd">        Processing Steps:</span>
<span class="sd">            - Group the transactions by timestamp and delivery_hour.</span>
<span class="sd">            - Calculate the volume weighted average price for each group.</span>
<span class="sd">            - Return a DataFrame with aggregated transaction data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame with the following columns:</span>
<span class="sd">                - timestamp: The UTC timestamp when the transaction occurred.</span>
<span class="sd">                - delivery_hour: The UTC timestamp of the delivery hour for the traded product.</span>
<span class="sd">                - vwap: The volume weighted average price of the transaction.</span>
<span class="sd">                - total_volume: The total volume of the transaction.</span>
<span class="sd">                - num_transactions: The number of transactions in the group.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">vwap_results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Group by timestamp and delivery_hour</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;delivery_hour&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">delivery_hour</span><span class="p">),</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Single transaction - use price and volume directly</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vwap</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
                <span class="n">total_volume</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Multiple transactions - calculate volume weighted average price</span>
                <span class="n">total_volume</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">weighted_price_sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">vwap</span> <span class="o">=</span> <span class="n">weighted_price_sum</span> <span class="o">/</span> <span class="n">total_volume</span> <span class="k">if</span> <span class="n">total_volume</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="n">vwap_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                <span class="s1">&#39;delivery_hour&#39;</span><span class="p">:</span> <span class="n">delivery_hour</span><span class="p">,</span>
                <span class="s1">&#39;vwap&#39;</span><span class="p">:</span> <span class="n">vwap</span><span class="p">,</span>
                <span class="s1">&#39;total_volume&#39;</span><span class="p">:</span> <span class="n">total_volume</span><span class="p">,</span>
                <span class="s1">&#39;num_transactions&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="p">})</span>

        <span class="k">if</span> <span class="n">vwap_results</span><span class="p">:</span>
            <span class="n">vwap_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">vwap_results</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vwap_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">vwap_df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_one_day</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_last</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the simulation for a single day.</span>

<span class="sd">        Args:</span>
<span class="sd">            is_last (bool): If True, indicates that this is the last iteration of data.</span>

<span class="sd">        Processing Steps:</span>
<span class="sd">            - Execute the simulation for the provided day&#39;s data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">is_last</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the logs generated by the simulation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing simulation logs with the following keys:</span>
<span class="sd">                - decision_record: Final simulation schedule.</span>
<span class="sd">                - price_record: CID price data over the simulation duration.</span>
<span class="sd">                - accepted_orders: Limit orders accepted by the RI.</span>
<span class="sd">                - executed_orders: Orders sent to the exchange by the RI.</span>
<span class="sd">                - killed_orders: Orders that were missed at the exchange.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># - forecast_orders: Orders virtually traded against the forecast.</span>
        <span class="c1"># - balancing_orders: Orders that would have incurred payments to the TSO.</span>
        <span class="n">decision_record</span><span class="p">,</span> <span class="n">price_record</span><span class="p">,</span> <span class="n">accepted_orders</span><span class="p">,</span> <span class="n">executed_orders</span><span class="p">,</span> <span class="n">forecast_orders</span><span class="p">,</span> <span class="n">killed_orders</span><span class="p">,</span> <span class="n">balancing_orders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">getLogs</span><span class="p">()</span>
        <span class="n">decision_record</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">decision_record</span><span class="p">)</span>
        <span class="n">price_record</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">price_record</span><span class="p">)</span>
        <span class="n">accepted_orders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">accepted_orders</span><span class="p">)</span>
        <span class="n">executed_orders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">executed_orders</span><span class="p">)</span>
        <span class="n">forecast_orders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">forecast_orders</span><span class="p">)</span>
        <span class="n">killed_orders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">killed_orders</span><span class="p">)</span>
        <span class="n">balancing_orders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">balancing_orders</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">decision_record</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">decision_record</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">decision_record</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">decision_record</span><span class="p">[</span><span class="s2">&quot;cycles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decision_record</span><span class="p">[</span><span class="s2">&quot;cycles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">price_record</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">price_record</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">price_record</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">accepted_orders</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;cancel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;cancel&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;delivery&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;delivery&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">executed_orders</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">executed_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">executed_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">executed_orders</span><span class="p">[</span><span class="s2">&quot;last_solve_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">executed_orders</span><span class="p">[</span><span class="s2">&quot;last_solve_time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">executed_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">executed_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">forecast_orders</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">forecast_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">forecast_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">forecast_orders</span><span class="p">[</span><span class="s2">&quot;last_solve_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">forecast_orders</span><span class="p">[</span><span class="s2">&quot;last_solve_time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">forecast_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">forecast_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">killed_orders</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">killed_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">killed_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">killed_orders</span><span class="p">[</span><span class="s2">&quot;last_solve_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">killed_orders</span><span class="p">[</span><span class="s2">&quot;last_solve_time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">killed_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">killed_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">balancing_orders</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">balancing_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">balancing_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">balancing_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">balancing_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">logs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;decision_record&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">decision_record</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
            <span class="s2">&quot;price_record&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">price_record</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
            <span class="s2">&quot;accepted_orders&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">accepted_orders</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
            <span class="s2">&quot;executed_orders&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">executed_orders</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
            <span class="c1"># &quot;forecast_orders&quot;: pd.DataFrame(forecast_orders, index=None), # removed for later versions of the code</span>
            <span class="s2">&quot;killed_orders&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">killed_orders</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
            <span class="c1"># &quot;balancing_orders&quot;: pd.DataFrame(balancing_orders, index=None), # removed for later versions of the code</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">logs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_transactions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve all transactions that have occurred since the last call and clear the internal transaction log.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame containing all transactions that occurred, with the following columns:</span>
<span class="sd">                - timestamp: The UTC timestamp when the transaction occurred.</span>
<span class="sd">                - delivery_hour: The UTC timestamp of the delivery hour for the traded product.</span>
<span class="sd">                - price: The execution price of the transaction (EUR/MWh).</span>
<span class="sd">                - volume: The volume of the transaction (MW).</span>
<span class="sd">                - buy_order_type: The type of the buy order (&#39;Market&#39; or &#39;Limit&#39;).</span>
<span class="sd">                - sell_order_type: The type of the sell order (&#39;Market&#39; or &#39;Limit&#39;).</span>
<span class="sd">                - buy_order_id: The ID of the buy order.</span>
<span class="sd">                - sell_order_id: The ID of the sell order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transactions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">getTransactions</span><span class="p">()</span>
        <span class="n">transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">transactions</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">transactions</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">transactions</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">transactions</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">transactions</span><span class="p">[</span><span class="s2">&quot;delivery_hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">transactions</span><span class="p">[</span><span class="s2">&quot;delivery_hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">transactions</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">print_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print the simulation parameters, including start/end times, storage settings, and various limits and costs.</span>

<span class="sd">        Processing Steps:</span>
<span class="sd">            - Extract simulation start, end, and trading start times from internal parameters.</span>
<span class="sd">            - Display all relevant storage configuration parameters.</span>
<span class="sd">            - Show trading and technical constraints.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">startMonth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startMonth</span>
        <span class="n">startDay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startDay</span>
        <span class="n">startYear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startYear</span>
        <span class="n">startHour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startHour</span>
        <span class="n">startMinute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startMinute</span>
        <span class="n">endMonth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endMonth</span>
        <span class="n">endDay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endDay</span>
        <span class="n">endYear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endYear</span>
        <span class="n">endHour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endHour</span>
        <span class="n">endMinute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endMinute</span>
        <span class="n">tradingStartMonth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartMonth</span>
        <span class="n">tradingStartDay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartDay</span>
        <span class="n">tradingStartYear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartYear</span>
        <span class="n">tradingStartHour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartHour</span>
        <span class="n">tradingStartMinute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartMinute</span>
        <span class="n">cycleLimit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cycleLimit</span>

        <span class="n">startDate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">startYear</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="n">startMonth</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="n">startDay</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="n">startHour</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="n">startMinute</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
        <span class="n">endDate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">endYear</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="n">endMonth</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="n">endDay</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="n">endHour</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="n">endMinute</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
        <span class="n">tradingStartDate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">tradingStartYear</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="n">tradingStartMonth</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="n">tradingStartDay</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="n">tradingStartHour</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="n">tradingStartMinute</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start Time (UTC):&quot;</span><span class="p">,</span> <span class="n">startDate</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;End Time (UTC):&quot;</span><span class="p">,</span> <span class="n">endDate</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trading Start Time (UTC):&quot;</span><span class="p">,</span> <span class="n">tradingStartDate</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Storage Maximum:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">storageMax</span><span class="p">,</span> <span class="s2">&quot;MWh&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Linear Degredation Cost:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">linDegCost</span><span class="p">,</span> <span class="s2">&quot;/MWh&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Injection Loss +:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">lossIn</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Withdrawal Loss -:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">lossOut</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trading Fee:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingFee</span><span class="p">,</span> <span class="s2">&quot;/MWh&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of DP Storage States:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">numStorStates</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Technical Delay:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pingDelay</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trading Delay:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">minuteDelay</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fixed Solve Time:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">fixedSolveTime</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Solve Frequency:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dpFreq</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Injection Maximum:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">injectMax</span><span class="p">,</span> <span class="s2">&quot;MW&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Withdrawal Maximum:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">withdrawMax</span><span class="p">,</span> <span class="s2">&quot;MW&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Log Transactions:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">logTransactions</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Only Traverse LOB:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">onlyTraverseLOB</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cycle Limit:&quot;</span><span class="p">,</span> <span class="n">cycleLimit</span><span class="p">)</span>
        <span class="c1"># print(&quot;Forecast Horizon Start:&quot;, self._sim_cpp.params.foreHorizonStart, &quot;min&quot;)</span>
        <span class="c1"># print(&quot;Forecast Horizon End:&quot;, self._sim_cpp.params.foreHorizonEnd, &quot;min&quot;)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">return_vol_price_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_last</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">frequency</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">volumes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve volume-price pairs from the simulation.</span>

<span class="sd">        Args:</span>
<span class="sd">            is_last (bool): If True, indicates this is the last iteration of data.</span>
<span class="sd">            frequency (int): The frequency (in seconds) at which price data is retrieved.</span>
<span class="sd">            volumes (np.ndarray): A 1D numpy array of volumes for which prices are returned.</span>

<span class="sd">        Processing Steps:</span>
<span class="sd">            - Validate input parameters for correct format and values.</span>
<span class="sd">            - Extract volume-price data from the simulation at specified frequency.</span>
<span class="sd">            - Convert timestamps to UTC format for consistency.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame with columns:</span>
<span class="sd">                - current_time: Time of the export (UTC).</span>
<span class="sd">                - delivery_hour: Delivery period time (UTC).</span>
<span class="sd">                - volume: The volume for which the price is exported (MWh).</span>
<span class="sd">                - price_full: The full price (cashflow) for the volume ().</span>
<span class="sd">                - worst_accepted_price: Market price of the worst matched order (/MWh).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;volumes must be a 1D numpy array&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;frequency must be &gt; 0&quot;</span><span class="p">)</span>

        <span class="n">vol_price_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">return_vol_price_pairs</span><span class="p">(</span><span class="n">is_last</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">volumes</span><span class="p">)</span>
        <span class="n">vol_price_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">vol_price_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">vol_price_list</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">vol_price_list</span><span class="p">[</span><span class="s2">&quot;current_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">vol_price_list</span><span class="p">[</span><span class="s2">&quot;current_time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">vol_price_list</span><span class="p">[</span><span class="s2">&quot;delivery_hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">vol_price_list</span><span class="p">[</span><span class="s2">&quot;delivery_hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">vol_price_list</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">submit_limit_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submit a list of limit orders and track their matches without battery optimization.</span>

<span class="sd">        This method validates input data and queues the limit orders for submission at specified times.</span>
<span class="sd">        The orders will be submitted during the normal simulation run without triggering battery optimization.</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pd.DataFrame): A DataFrame containing the limit orders to be submitted.</span>
<span class="sd">                The DataFrame must have the following columns:</span>
<span class="sd">                    - transaction_time: The time when the order should be submitted (timezone aware, up to millisecond precision).</span>
<span class="sd">                    - price: The price of the limit order (/MWh).</span>
<span class="sd">                    - volume: The volume of the limit order (MWh, positive for buy, negative for sell).</span>
<span class="sd">                    - side: The side of the order (&#39;buy&#39; or &#39;sell&#39;).</span>
<span class="sd">                    - delivery_time: The delivery time for the order (timezone aware, required).</span>

<span class="sd">        Processing Steps:</span>
<span class="sd">            - Validates input data format and required columns.</span>
<span class="sd">            - Ensures timezone awareness and proper formatting of timestamps.</span>
<span class="sd">            - Queues the limit orders for submission during simulation execution.</span>
<span class="sd">            - Orders are processed without triggering battery optimization.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None: This method queues orders but does not return match information.</span>
<span class="sd">                After running the simulation, use get_limit_order_matches() to retrieve match details.</span>

<span class="sd">        Note:</span>
<span class="sd">            Call this method to queue own limit orders, then run the simulation to process them and collect matches.</span>
<span class="sd">            Use get_limit_order_matches() after simulation to retrieve final match results.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Validate input DataFrame</span>
        <span class="n">required_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;transaction_time&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="s1">&#39;delivery_time&#39;</span><span class="p">]</span>
        <span class="n">missing_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">required_columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing_columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required columns: </span><span class="si">{</span><span class="n">missing_columns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Check if transaction_time is timezone aware</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;transaction_time must be timezone aware&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;transaction_time cannot contain NaT values - all transaction times are required&quot;</span><span class="p">)</span>

        <span class="c1"># Check if delivery_time is timezone aware and has no NaT values</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;delivery_time must be timezone aware&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;delivery_time cannot contain NaT values - all delivery times are required&quot;</span><span class="p">)</span>

        <span class="c1"># check that the delivery time is a full hour exactly</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;delivery_time must be a full hour exactly for hourly products&quot;</span><span class="p">)</span>

        <span class="c1"># volume must be &gt; 0</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;volume must be &gt; 0&quot;</span><span class="p">)</span>

        <span class="c1"># Convert to UTC</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>

        <span class="c1"># Validate side column</span>
        <span class="n">valid_sides</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;buy&#39;</span><span class="p">,</span> <span class="s1">&#39;sell&#39;</span><span class="p">,</span> <span class="s1">&#39;Buy&#39;</span><span class="p">,</span> <span class="s1">&#39;Sell&#39;</span><span class="p">,</span> <span class="s1">&#39;BUY&#39;</span><span class="p">,</span> <span class="s1">&#39;SELL&#39;</span><span class="p">}</span>
        <span class="n">invalid_sides</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;side&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">invalid_sides</span> <span class="o">=</span> <span class="p">[</span><span class="n">side</span> <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="n">invalid_sides</span> <span class="k">if</span> <span class="n">side</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_sides</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">invalid_sides</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid side values: </span><span class="si">{</span><span class="n">invalid_sides</span><span class="si">}</span><span class="s2">. Must be one of: </span><span class="si">{</span><span class="n">valid_sides</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Normalize side values to &#39;Buy&#39;/&#39;Sell&#39;</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;side&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;side&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>

        <span class="c1"># Convert timestamps to ISO format</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Z&#39;</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%SZ&#39;</span><span class="p">)</span>

        <span class="c1"># Prepare data for C++ function</span>
        <span class="n">transaction_times</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">prices</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">volumes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">sides</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;side&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">delivery_times</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># Call C++ function to submit limit orders (no return value)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">submitLimitOrdersAndGetMatches</span><span class="p">(</span><span class="n">transaction_times</span><span class="p">,</span> <span class="n">prices</span><span class="p">,</span> <span class="n">volumes</span><span class="p">,</span> <span class="n">sides</span><span class="p">,</span> <span class="n">delivery_times</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_limit_order_matches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the limit order matches collected during simulation using the forecast tracking mechanism.</span>

<span class="sd">        This method retrieves match information for submitted limit orders that were processed</span>
<span class="sd">        during the simulation run. The orders are tracked using the forecast flag system.</span>

<span class="sd">        Processing Steps:</span>
<span class="sd">            - Retrieves match data from the C++ simulation backend.</span>
<span class="sd">            - Converts timestamps to timezone-aware datetime objects.</span>
<span class="sd">            - Clears the internal match storage after retrieval.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame containing information about which limit orders were matched against which existing orders.</span>
<span class="sd">                The DataFrame contains the following columns:</span>
<span class="sd">                    - submitted_order_id: The ID of the submitted limit order.</span>
<span class="sd">                    - matched_order_id: The ID of the existing order that was matched.</span>
<span class="sd">                    - match_timestamp: The timestamp when the match occurred.</span>
<span class="sd">                    - delivery_hour: The delivery hour for the matched order.</span>
<span class="sd">                    - match_price: The price at which the orders were matched, i.e., the price of the existing (partially) matched order (/MWh).</span>
<span class="sd">                    - match_volume: The volume that was matched (MWh).</span>
<span class="sd">                    - submitted_order_side: The side of the submitted order (&#39;buy&#39; or &#39;sell&#39;).</span>
<span class="sd">                    - existing_order_side: The side of the existing order (&#39;buy&#39; or &#39;sell&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">getLimitOrderMatches</span><span class="p">()</span>
        <span class="n">matches_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>

        <span class="c1"># Convert timestamps to datetime if not empty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matches_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">matches_df</span><span class="p">[</span><span class="s2">&quot;match_timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">matches_df</span><span class="p">[</span><span class="s2">&quot;match_timestamp&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">matches_df</span><span class="p">[</span><span class="s2">&quot;delivery_hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">matches_df</span><span class="p">[</span><span class="s2">&quot;delivery_hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No limit order matches to return.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">clearLimitOrderMatches</span><span class="p">()</span> <span class="c1"># clear existing matches</span>

        <span class="k">return</span> <span class="n">matches_df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">has_orders_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if there are remaining orders in the order queue.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if there are remaining orders in the queue, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">hasOrdersRemaining</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_stop_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stop_time</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a datetime with millisecond precision to stop the simulation once.</span>

<span class="sd">        The simulation will stop only once, if the last order added has a submission time</span>
<span class="sd">        after the stop time. Once the simulation has stopped, the stop time is automatically</span>
<span class="sd">        cleared, allowing you to set a new one.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stop_time : pd.Timestamp</span>
<span class="sd">            A timezone-aware timestamp with millisecond precision when the simulation should stop.</span>
<span class="sd">            The simulation will stop if the last processed order&#39;s submission time is &gt; this stop time.</span>
<span class="sd">        verbose : bool, optional</span>
<span class="sd">            Whether to print a message when the simulation stops.</span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If stop_time is not timezone aware.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The stop time is checked after each order is processed</span>
<span class="sd">        - The simulation stops only once per stop time setting</span>
<span class="sd">        - After stopping, the stop time is automatically cleared</span>
<span class="sd">        - You can set a new stop time after the simulation has stopped</span>
<span class="sd">        - The stop time is compared against the order&#39;s submission time (transaction time)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if timezone aware</span>
        <span class="k">if</span> <span class="n">stop_time</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;stop_time must be timezone aware&quot;</span><span class="p">)</span>

        <span class="c1"># Convert to UTC</span>
        <span class="n">stop_time_utc</span> <span class="o">=</span> <span class="n">stop_time</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>

        <span class="c1"># Convert to milliseconds since epoch</span>
        <span class="n">stop_time_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stop_time_utc</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="c1"># Call C++ method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">setStopTime</span><span class="p">(</span><span class="n">stop_time_ms</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Solve the dynamic programming problem once using the time of the last placed order.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            A DataFrame containing the suggested to be executed market orders from the solve.</span>
<span class="sd">            Columns include: dp_run, time, last_solve_time, hour, reward,</span>
<span class="sd">            reward_incl_deg_costs, volume, type, final_pos, final_stor.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function calls the C++ solve() method once. It does not run the</span>
<span class="sd">        full simulation, only performs a single DP solve at the time of the</span>
<span class="sd">        last placed order. If no orders have been placed yet, the behavior</span>
<span class="sd">        depends on the initial state of _lastOrder_placementTime.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; orders_df = sim.solve()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Call C++ method (no parameters needed - uses last order placement time)</span>
        <span class="n">order_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

        <span class="c1"># Convert list of dicts to pandas DataFrame</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">order_list</span><span class="p">:</span>
            <span class="c1"># Return empty DataFrame with expected columns</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                <span class="s1">&#39;dp_run&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;last_solve_time&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;reward&#39;</span><span class="p">,</span>
                <span class="s1">&#39;reward_incl_deg_costs&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;final_pos&#39;</span><span class="p">,</span> <span class="s1">&#39;final_stor&#39;</span>
            <span class="p">])</span>

        <span class="n">order_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">order_list</span><span class="p">)</span>
        <span class="n">order_df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">order_df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">order_df</span><span class="p">[</span><span class="s1">&#39;last_solve_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">order_df</span><span class="p">[</span><span class="s1">&#39;last_solve_time&#39;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">order_df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">order_df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">order_df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transform_lob_to_levels</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lob_state_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">exchange</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EPEX&quot;</span><span class="p">,</span>
        <span class="n">product_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;XBID_Hour_Power&quot;</span><span class="p">,</span>
        <span class="n">delivery_area</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;10YDE-VE-------2&quot;</span><span class="p">,</span>
        <span class="n">product_duration_hours</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms the output of get_limit_order_book_state (individual orders)</span>
<span class="sd">        into an aggregated, price-level-based DataFrame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lob_state_df : pd.DataFrame</span>
<span class="sd">            The DataFrame returned by get_limit_order_book_state.</span>
<span class="sd">            Must contain columns: &#39;delivery_time&#39;, &#39;side&#39;, &#39;price&#39;, &#39;volume&#39;.</span>
<span class="sd">        exchange : str, optional</span>
<span class="sd">            Static value for the &#39;exchange&#39; column in the output.</span>
<span class="sd">        product_name : str, optional</span>
<span class="sd">            Static value for the &#39;product&#39; column in the output.</span>
<span class="sd">        delivery_area : str, optional</span>
<span class="sd">            Static value for the &#39;deliveryArea&#39; column in the output.</span>
<span class="sd">        product_duration_hours : int, optional</span>
<span class="sd">            Duration of the product in hours, used to calculate</span>
<span class="sd">            deliveryEndUtc from delivery_time (which is used as deliveryStartUtc).</span>
<span class="sd">            Default is 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            A DataFrame in the target format with aggregated price levels and columns:</span>
<span class="sd">            [&#39;exchange&#39;, &#39;product&#39;, &#39;deliveryStartUtc&#39;, &#39;deliveryEndUtc&#39;,</span>
<span class="sd">            &#39;deliveryArea&#39;, &#39;side&#39;, &#39;level&#39;, &#39;price&#39;, &#39;quantity&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Define the target column order</span>
        <span class="n">target_columns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;exchange&#39;</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="s1">&#39;deliveryStartUtc&#39;</span><span class="p">,</span> <span class="s1">&#39;deliveryEndUtc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;deliveryArea&#39;</span><span class="p">,</span> <span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;quantity&#39;</span>
        <span class="p">]</span>

        <span class="c1"># Keep only the columns we need from the start</span>
        <span class="n">source_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;delivery_time&#39;</span><span class="p">,</span> <span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">]</span>

        <span class="c1"># Handle empty input DataFrame</span>
        <span class="k">if</span> <span class="n">lob_state_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">target_columns</span><span class="p">)</span>

        <span class="n">all_orders_dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">product_duration</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">product_duration_hours</span><span class="p">)</span>

        <span class="c1"># Group by each product (identified by its delivery_time)</span>
        <span class="k">for</span> <span class="n">delivery_time</span><span class="p">,</span> <span class="n">product_df</span> <span class="ow">in</span> <span class="n">lob_state_df</span><span class="p">[</span><span class="n">source_columns</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;delivery_time&#39;</span><span class="p">):</span>

            <span class="n">delivery_start_utc</span> <span class="o">=</span> <span class="n">delivery_time</span>
            <span class="n">delivery_end_utc</span> <span class="o">=</span> <span class="n">delivery_start_utc</span> <span class="o">+</span> <span class="n">product_duration</span>

            <span class="c1"># --- Process Bids (Source &#39;buy&#39; side) ---</span>
            <span class="n">buys_df</span> <span class="o">=</span> <span class="n">product_df</span><span class="p">[</span><span class="n">product_df</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;buy&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">buys_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="c1"># We assume buys_df is already sorted by price (descending)</span>
                <span class="n">bids_1_to_1</span> <span class="o">=</span> <span class="n">buys_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Set level as the order rank</span>
                <span class="n">bids_1_to_1</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bids_1_to_1</span><span class="o">.</span><span class="n">index</span>
                <span class="n">bids_1_to_1</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bid&#39;</span>
                <span class="n">bids_1_to_1</span> <span class="o">=</span> <span class="n">bids_1_to_1</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="s1">&#39;quantity&#39;</span><span class="p">})</span>

                <span class="c1"># Add common metadata</span>
                <span class="n">bids_1_to_1</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exchange</span>
                <span class="n">bids_1_to_1</span><span class="p">[</span><span class="s1">&#39;product&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">product_name</span>
                <span class="n">bids_1_to_1</span><span class="p">[</span><span class="s1">&#39;deliveryStartUtc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delivery_start_utc</span>
                <span class="n">bids_1_to_1</span><span class="p">[</span><span class="s1">&#39;deliveryEndUtc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delivery_end_utc</span>
                <span class="n">bids_1_to_1</span><span class="p">[</span><span class="s1">&#39;deliveryArea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delivery_area</span>

                <span class="n">all_orders_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bids_1_to_1</span><span class="p">[</span><span class="n">target_columns</span><span class="p">])</span> <span class="c1"># Select only target cols</span>

            <span class="c1"># --- Process Asks (Source &#39;sell&#39; side) ---</span>
            <span class="n">sells_df</span> <span class="o">=</span> <span class="n">product_df</span><span class="p">[</span><span class="n">product_df</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sell&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sells_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="c1"># We assume sells_df is already sorted by price (ascending)</span>
                <span class="n">asks_1_to_1</span> <span class="o">=</span> <span class="n">sells_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Set level as the order rank</span>
                <span class="n">asks_1_to_1</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">asks_1_to_1</span><span class="o">.</span><span class="n">index</span>
                <span class="n">asks_1_to_1</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ask&#39;</span>
                <span class="n">asks_1_to_1</span> <span class="o">=</span> <span class="n">asks_1_to_1</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="s1">&#39;quantity&#39;</span><span class="p">})</span>

                <span class="c1"># Add common metadata</span>
                <span class="n">asks_1_to_1</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exchange</span>
                <span class="n">asks_1_to_1</span><span class="p">[</span><span class="s1">&#39;product&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">product_name</span>
                <span class="n">asks_1_to_1</span><span class="p">[</span><span class="s1">&#39;deliveryStartUtc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delivery_start_utc</span>
                <span class="n">asks_1_to_1</span><span class="p">[</span><span class="s1">&#39;deliveryEndUtc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delivery_end_utc</span>
                <span class="n">asks_1_to_1</span><span class="p">[</span><span class="s1">&#39;deliveryArea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delivery_area</span>

                <span class="n">all_orders_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asks_1_to_1</span><span class="p">[</span><span class="n">target_columns</span><span class="p">])</span> <span class="c1"># Select only target cols</span>

        <span class="c1"># Handle case where input was not empty but contained no orders</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_orders_dfs</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">target_columns</span><span class="p">)</span>

        <span class="c1"># Combine all products and sides into one DataFrame</span>
        <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_orders_dfs</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">final_df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_limit_order_book_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_action</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the current state of all active limit order books at the last-set stop time.</span>

<span class="sd">        This method returns, for each tradable product (delivery hour), the individual limit orders</span>
<span class="sd">        in the buy and sell queues with all their attributes, up to a cumulative volume of max_action.</span>
<span class="sd">        The query time is automatically set to the last-set stop time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        max_action : float, optional</span>
<span class="sd">            The maximum cumulative volume to query in MW (= MWh for 1-hour products).</span>
<span class="sd">            If None (default), uses inject_max + withdraw_max from simulation parameters.</span>
<span class="sd">            Must be &gt; 0 if specified.</span>
<span class="sd">        return_dict : bool, optional</span>
<span class="sd">            Whether to return the limit order book state as a dictionary.</span>
<span class="sd">            If True, the return value is a dictionary with the delivery time as the key and the limit order book state as the value.</span>
<span class="sd">            If False (default), the return value is a DataFrame.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame or dict</span>
<span class="sd">            A DataFrame containing the limit orders with the following columns:</span>
<span class="sd">                - delivery_time: The delivery time of the product (UTC timestamp)</span>
<span class="sd">                - side: &#39;sell&#39; or &#39;buy&#39; (sell orders are where you can buy from, buy orders are where you can sell to)</span>
<span class="sd">                - order_id: The unique order ID</span>
<span class="sd">                - initial_id: The initial order ID (for tracking order modifications)</span>
<span class="sd">                - start_time: When the order was placed (UTC timestamp)</span>
<span class="sd">                - cancel_time: When the order expires (UTC timestamp)</span>
<span class="sd">                - price: The limit order price in EUR/MWh</span>
<span class="sd">                - volume: The order volume in MWh</span>
<span class="sd">                - is_forecast: Whether this is a forecast order (bool)</span>
<span class="sd">                - cumulative_volume: The cumulative volume up to and including this order in MWh</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - Uses the simulation&#39;s internal current time (_lastOrder_placementTime)</span>
<span class="sd">        - Sell orders are sorted by ascending price (cheapest first = best for buying)</span>
<span class="sd">        - Buy orders are sorted by descending price (highest first = best for selling)</span>
<span class="sd">        - Orders are filtered to exclude expired orders at the query time</span>
<span class="sd">        - Cumulative volume stops at max_action (default: inject_max + withdraw_max)</span>
<span class="sd">        - Each row represents one limit order in the order book</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; # Query order book state with default max_action (inject_max + withdraw_max)</span>
<span class="sd">        &gt;&gt;&gt; lob_state = sim.get_limit_order_book_state()</span>
<span class="sd">        &gt;&gt;&gt; # Query with custom max_action</span>
<span class="sd">        &gt;&gt;&gt; lob_state = sim.get_limit_order_book_state(max_action=20.0)</span>
<span class="sd">        &gt;&gt;&gt; # Filter to see sell orders for a specific product</span>
<span class="sd">        &gt;&gt;&gt; product_sells = lob_state[(lob_state[&#39;delivery_time&#39;] == some_time) &amp; (lob_state[&#39;side&#39;] == &#39;sell&#39;)]</span>
<span class="sd">        &gt;&gt;&gt; # See the best (cheapest) sell price</span>
<span class="sd">        &gt;&gt;&gt; best_sell_price = product_sells.iloc[0][&#39;price&#39;]</span>
<span class="sd">        &gt;&gt;&gt; # Filter to see only forecast orders</span>
<span class="sd">        &gt;&gt;&gt; forecast_orders = lob_state[lob_state[&#39;is_forecast&#39;] == True]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Determine max_action value</span>
        <span class="k">if</span> <span class="n">max_action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use inject_max + withdraw_max as default</span>
            <span class="n">max_action_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">injectMax</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">withdrawMax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Validate that max_action is positive</span>
            <span class="k">if</span> <span class="n">max_action</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_action must be &gt; 0&quot;</span><span class="p">)</span>
            <span class="n">max_action_value</span> <span class="o">=</span> <span class="n">max_action</span>

        <span class="c1"># Call C++ function (uses simulation&#39;s current time internally)</span>
        <span class="n">lob_state_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">getLimitOrderBookState</span><span class="p">(</span><span class="n">max_action_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lob_state_dict</span>

        <span class="c1"># Convert to DataFrame</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">delivery_time_ms</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">lob_state_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">delivery_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">delivery_time_ms</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>

            <span class="c1"># Process sell orders (where we can buy from)</span>
            <span class="n">sell_ids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sell_ids&#39;</span><span class="p">]</span>
            <span class="n">sell_initial_ids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sell_initial_ids&#39;</span><span class="p">]</span>
            <span class="n">sell_starts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sell_starts&#39;</span><span class="p">]</span>
            <span class="n">sell_cancels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sell_cancels&#39;</span><span class="p">]</span>
            <span class="n">sell_prices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sell_prices&#39;</span><span class="p">]</span>
            <span class="n">sell_volumes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sell_volumes&#39;</span><span class="p">]</span>
            <span class="n">sell_forecasts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sell_forecasts&#39;</span><span class="p">]</span>

            <span class="n">cumulative_sell_volume</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">order_id</span><span class="p">,</span> <span class="n">initial_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">cancel</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">forecast</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">sell_ids</span><span class="p">,</span> <span class="n">sell_initial_ids</span><span class="p">,</span> <span class="n">sell_starts</span><span class="p">,</span> <span class="n">sell_cancels</span><span class="p">,</span> <span class="n">sell_prices</span><span class="p">,</span> <span class="n">sell_volumes</span><span class="p">,</span> <span class="n">sell_forecasts</span>
            <span class="p">):</span>
                <span class="n">cumulative_sell_volume</span> <span class="o">+=</span> <span class="n">volume</span>
                <span class="c1"># Handle sentinel cancel time values (e.g., max int64) that overflow pandas timestamps</span>
                <span class="n">cancel_ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">cancel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">value</span> <span class="o">//</span> <span class="mi">1_000_000</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cancel</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;delivery_time&#39;</span><span class="p">:</span> <span class="n">delivery_time</span><span class="p">,</span>
                    <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="s1">&#39;sell&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;order_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">),</span>
                    <span class="s1">&#39;initial_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">initial_id</span><span class="p">),</span>
                    <span class="s1">&#39;start_time&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;cancel_time&#39;</span><span class="p">:</span> <span class="n">cancel_ts</span><span class="p">,</span>
                    <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="n">price</span><span class="p">,</span>
                    <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="n">volume</span><span class="p">,</span>
                    <span class="s1">&#39;is_forecast&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">forecast</span><span class="p">),</span>
                    <span class="s1">&#39;cumulative_volume&#39;</span><span class="p">:</span> <span class="n">cumulative_sell_volume</span>
                <span class="p">})</span>

            <span class="c1"># Process buy orders (where we can sell to)</span>
            <span class="n">buy_ids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buy_ids&#39;</span><span class="p">]</span>
            <span class="n">buy_initial_ids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buy_initial_ids&#39;</span><span class="p">]</span>
            <span class="n">buy_starts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buy_starts&#39;</span><span class="p">]</span>
            <span class="n">buy_cancels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buy_cancels&#39;</span><span class="p">]</span>
            <span class="n">buy_prices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buy_prices&#39;</span><span class="p">]</span>
            <span class="n">buy_volumes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buy_volumes&#39;</span><span class="p">]</span>
            <span class="n">buy_forecasts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buy_forecasts&#39;</span><span class="p">]</span>

            <span class="n">cumulative_buy_volume</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">order_id</span><span class="p">,</span> <span class="n">initial_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">cancel</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">forecast</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">buy_ids</span><span class="p">,</span> <span class="n">buy_initial_ids</span><span class="p">,</span> <span class="n">buy_starts</span><span class="p">,</span> <span class="n">buy_cancels</span><span class="p">,</span> <span class="n">buy_prices</span><span class="p">,</span> <span class="n">buy_volumes</span><span class="p">,</span> <span class="n">buy_forecasts</span>
            <span class="p">):</span>
                <span class="n">cumulative_buy_volume</span> <span class="o">+=</span> <span class="n">volume</span>
                <span class="c1"># Handle sentinel cancel time values (e.g., max int64) that overflow pandas timestamps</span>
                <span class="n">cancel_ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">cancel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">value</span> <span class="o">//</span> <span class="mi">1_000_000</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cancel</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;delivery_time&#39;</span><span class="p">:</span> <span class="n">delivery_time</span><span class="p">,</span>
                    <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="s1">&#39;buy&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;order_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">),</span>
                    <span class="s1">&#39;initial_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">initial_id</span><span class="p">),</span>
                    <span class="s1">&#39;start_time&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;cancel_time&#39;</span><span class="p">:</span> <span class="n">cancel_ts</span><span class="p">,</span>
                    <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="n">price</span><span class="p">,</span>
                    <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="n">volume</span><span class="p">,</span>
                    <span class="s1">&#39;is_forecast&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">forecast</span><span class="p">),</span>
                    <span class="s1">&#39;cumulative_volume&#39;</span><span class="p">:</span> <span class="n">cumulative_buy_volume</span>
                <span class="p">})</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reached_end_of_day</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_last</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the order queue has reached the end for this day.</span>

<span class="sd">        This function mirrors the logic of run_one_day(is_last) for checking</span>
<span class="sd">        whether we&#39;ve processed all available orders in the current batch.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        is_last : bool</span>
<span class="sd">            Whether this is the last data batch (same semantics as run_one_day).</span>
<span class="sd">            - If False: indicates more data-days will be loaded after this batch</span>
<span class="sd">            - If True: indicates this is the final batch of data-days for this simulation</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if there are no more orders to process in the queue, False otherwise.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - Returns True when orderQueue.hasNext() is False in C++</span>
<span class="sd">        - The is_last parameter is kept for API consistency with run_one_day</span>
<span class="sd">        - Use this to check if the simulation stopped because it ran out of orders</span>
<span class="sd">          vs. stopping due to a stop time or stop hour</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; sim.run_one_day(is_last=False)</span>
<span class="sd">        &gt;&gt;&gt; if sim.reached_end_of_day(is_last=False):</span>
<span class="sd">        ...     print(&quot;Processed all orders in current batch, ready for next day&#39;s data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; elif sim.has_stopped_at_stop_time():</span>
<span class="sd">        ...     print(&quot;Stopped at specified stop time&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">reachedEndOfDay</span><span class="p">(</span><span class="n">is_last</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">has_stopped_at_stop_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the simulation has stopped due to the stop time being reached. Is set to false again once we set a new stop time.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the simulation stopped because the last order&#39;s submission time</span>
<span class="sd">            exceeded the set stop time. False otherwise.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - This flag is set when the simulation stops due to a stop time set via set_stop_time()</span>
<span class="sd">        - The flag is automatically reset when a new stop time is set</span>
<span class="sd">        - Use this to determine if a simulation pause was due to the stop time condition</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; sim.set_stop_time(pd.Timestamp(&#39;2024-01-15 12:30:00&#39;, tz=&#39;UTC&#39;))</span>
<span class="sd">        &gt;&gt;&gt; sim.run_one_day(is_last=False)</span>
<span class="sd">        &gt;&gt;&gt; if sim.has_stopped_at_stop_time():</span>
<span class="sd">        ...     print(&quot;Simulation stopped at the specified stop time&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">hasStoppedAtStopTime</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_last_order_placement_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the simulation&#39;s current time (last processed order&#39;s placement time) as a UTC datetime.</span>

<span class="sd">        This returns the internal `_lastOrder_placementTime` from the C++ simulation,</span>
<span class="sd">        converted to a timezone-aware pandas Timestamp in UTC.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.Timestamp</span>
<span class="sd">            The timestamp of the last processed order&#39;s placement time in UTC.</span>
<span class="sd">            Returns pd.NaT if no orders have been processed yet (time is at minimum int64 value).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The internal time is stored as milliseconds since epoch (Unix time)</span>
<span class="sd">        - This is the time used by methods like get_limit_order_book_state() and solve()</span>
<span class="sd">        - Before any orders are processed, this returns pd.NaT</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; sim.add_bin_to_orderqueue(&quot;path/to/data.bin&quot;)</span>
<span class="sd">        &gt;&gt;&gt; sim.run_one_day(is_last=False)</span>
<span class="sd">        &gt;&gt;&gt; current_time = sim.get_last_order_placement_time()</span>
<span class="sd">        &gt;&gt;&gt; print(current_time)</span>
<span class="sd">        2024-01-15 12:30:45.123000+00:00</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">getLastOrderPlacementTimeMs</span><span class="p">()</span>

        <span class="c1"># Handle uninitialized state (minimum int64 value)</span>
        <span class="c1"># In C++, it&#39;s initialized to std::numeric_limits&lt;int64_t&gt;::min()</span>
        <span class="k">if</span> <span class="n">time_ms</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

        <span class="c1"># Convert milliseconds since epoch to UTC timestamp</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">time_ms</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_next_order_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the order queue&#39;s next order start time as a UTC datetime.</span>

<span class="sd">        This peeks at the next order in the queue without consuming it, returning</span>
<span class="sd">        its start time (placement time) converted to a timezone-aware pandas Timestamp in UTC.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.Timestamp</span>
<span class="sd">            The timestamp of the next order&#39;s start time in UTC.</span>
<span class="sd">            Returns pd.NaT if no more orders are available in the queue.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The internal time is stored as milliseconds since epoch (Unix time)</span>
<span class="sd">        - This does not advance the order queue; it only peeks at the next order</span>
<span class="sd">        - Useful for determining when the next order will be processed</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; sim.add_bin_to_orderqueue(&quot;path/to/data.bin&quot;)</span>
<span class="sd">        &gt;&gt;&gt; next_time = sim.get_next_order_start_time()</span>
<span class="sd">        &gt;&gt;&gt; print(next_time)</span>
<span class="sd">        2024-01-15 12:30:45.123000+00:00</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">getNextOrderStartTimeMs</span><span class="p">()</span>

        <span class="c1"># Handle case when no next order exists (minimum int64 value)</span>
        <span class="k">if</span> <span class="n">time_ms</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

        <span class="c1"># Convert milliseconds since epoch to UTC timestamp</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">time_ms</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">trading_start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_max</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">lin_deg_cost</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">loss_in</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">loss_out</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">trading_fee</span><span class="o">=</span><span class="mf">0.09</span><span class="p">,</span> <span class="n">num_stor_states</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">trading_delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tec_delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fixed_solve_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">solve_frequency</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">withdraw_max</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">inject_max</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">log_transactions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_traverse_lob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cycle_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_hot_queue_size</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize a Simulation instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>start_date</code>
            </td>
            <td>
                  <code><span title="pandas.Timestamp">Timestamp</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start datetime of the simulation, i.e. which products are loaded into the simulation. Must be timezone aware.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date</code>
            </td>
            <td>
                  <code><span title="pandas.Timestamp">Timestamp</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end datetime of the simulation, i.e. which products are loaded into the simulation. Must be timezone aware.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trading_start_date</code>
            </td>
            <td>
                  <code><span title="pandas.Timestamp">Timestamp</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start datetime of the trading, i.e. when the trading starts. Must be timezone aware. If None, the trading starts at the same time as the start_date.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>storage_max</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum storage capacity of the storage unit (MWh). Default is 10.0.</p>
              </div>
            </td>
            <td>
                  <code>10.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lin_deg_cost</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The linear degradation cost of the storage unit (/MWh). Default is 4.0.</p>
              </div>
            </td>
            <td>
                  <code>4.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>loss_in</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The injection efficiency of the storage unit (0-1]. Default is 0.95.</p>
              </div>
            </td>
            <td>
                  <code>0.95</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>loss_out</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The withdrawal efficiency of the storage unit (0-1]. Default is 0.95.</p>
              </div>
            </td>
            <td>
                  <code>0.95</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trading_fee</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The trading fee for the exchange (/MWh). Default is 0.09.</p>
              </div>
            </td>
            <td>
                  <code>0.09</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_stor_states</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of storage states for dynamic programming. Default is 11.</p>
              </div>
            </td>
            <td>
                  <code>11</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trading_delay</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The trading delay of the storage unit, i.e., when to start trading all new products after gate opening. (min, &gt;= 0 and &lt; 480 mins (8 hours)). Default is 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tec_delay</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The technical delay of the storage unit (ms, &gt;= 0). Default is 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fixed_solve_time</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The fixed solve time for dynamic programming (ms, &gt;= 0 or -1 for realistic solve times). Default is 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>solve_frequency</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The frequency at which the dynamic programming solver is run (min). Default is 0.0.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>withdraw_max</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum withdrawal power of the storage unit (MW). Default is 5.0.</p>
              </div>
            </td>
            <td>
                  <code>5.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inject_max</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum injection power of the storage unit (MW). Default is 5.0.</p>
              </div>
            </td>
            <td>
                  <code>5.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>log_transactions</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, we run the simulation only to log transactions data of the market, no optimization is performed. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>only_traverse_lob</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to only traverse the LOB and not call any DP solves. (bool, default: False)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cycle_limit</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The limit on the number of cycles per Berlin-time day. Setting it comes at a cost in terms of solve time. (float, &gt; 0). Default is None, where no cycle limit is enforced.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_hot_queue_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum number of orders to keep in the hot cache for each order queue. (int, &gt; 0, or -1 to disable and use only volume-based caching, default: -1)</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
             <span class="n">trading_start_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">storage_max</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span>
             <span class="n">lin_deg_cost</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span>
             <span class="n">loss_in</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
             <span class="n">loss_out</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
             <span class="n">trading_fee</span><span class="o">=</span><span class="mf">0.09</span><span class="p">,</span>
             <span class="n">num_stor_states</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
             <span class="n">trading_delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
             <span class="n">tec_delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
             <span class="n">fixed_solve_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
             <span class="n">solve_frequency</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
             <span class="n">withdraw_max</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span>
             <span class="n">inject_max</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span>
             <span class="n">log_transactions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">only_traverse_lob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">cycle_limit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">min_hot_queue_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,):</span>
            <span class="c1">#  forecast_horizon_start=10*60,</span>
            <span class="c1">#  forecast_horizon_end=75):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize a Simulation instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        start_date (pd.Timestamp): The start datetime of the simulation, i.e. which products are loaded into the simulation. Must be timezone aware.</span>
<span class="sd">        end_date (pd.Timestamp): The end datetime of the simulation, i.e. which products are loaded into the simulation. Must be timezone aware.</span>
<span class="sd">        trading_start_date (pd.Timestamp, optional): The start datetime of the trading, i.e. when the trading starts. Must be timezone aware. If None, the trading starts at the same time as the start_date.</span>
<span class="sd">        storage_max (float, optional): The maximum storage capacity of the storage unit (MWh). Default is 10.0.</span>
<span class="sd">        lin_deg_cost (float, optional): The linear degradation cost of the storage unit (/MWh). Default is 4.0.</span>
<span class="sd">        loss_in (float, optional): The injection efficiency of the storage unit (0-1]. Default is 0.95.</span>
<span class="sd">        loss_out (float, optional): The withdrawal efficiency of the storage unit (0-1]. Default is 0.95.</span>
<span class="sd">        trading_fee (float, optional): The trading fee for the exchange (/MWh). Default is 0.09.</span>
<span class="sd">        num_stor_states (int, optional): The number of storage states for dynamic programming. Default is 11.</span>
<span class="sd">        trading_delay (int, optional): The trading delay of the storage unit, i.e., when to start trading all new products after gate opening. (min, &gt;= 0 and &lt; 480 mins (8 hours)). Default is 0.</span>
<span class="sd">        tec_delay (int, optional): The technical delay of the storage unit (ms, &gt;= 0). Default is 0.</span>
<span class="sd">        fixed_solve_time (int, optional): The fixed solve time for dynamic programming (ms, &gt;= 0 or -1 for realistic solve times). Default is 0.</span>
<span class="sd">        solve_frequency (float, optional): The frequency at which the dynamic programming solver is run (min). Default is 0.0.</span>
<span class="sd">        withdraw_max (float, optional): The maximum withdrawal power of the storage unit (MW). Default is 5.0.</span>
<span class="sd">        inject_max (float, optional): The maximum injection power of the storage unit (MW). Default is 5.0.</span>
<span class="sd">        log_transactions (bool, optional): If True, we run the simulation only to log transactions data of the market, no optimization is performed. Default is False.</span>
<span class="sd">        only_traverse_lob: Whether to only traverse the LOB and not call any DP solves. (bool, default: False)</span>
<span class="sd">        cycle_limit: The limit on the number of cycles per Berlin-time day. Setting it comes at a cost in terms of solve time. (float, &gt; 0). Default is None, where no cycle limit is enforced.</span>
<span class="sd">        min_hot_queue_size: The minimum number of orders to keep in the hot cache for each order queue. (int, &gt; 0, or -1 to disable and use only volume-based caching, default: -1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># forecast_horizon_start (int, optional): The start of the forecast horizon (min). Default is 600.</span>
    <span class="c1"># forecast_horizon_end (int, optional): The end of the forecast horizon (min). Default is 75.</span>

    <span class="c1"># write all the assertions</span>
    <span class="k">if</span> <span class="n">start_date</span> <span class="o">&gt;=</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;start_date must be before end_date&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">trading_start_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">trading_start_date</span> <span class="o">=</span> <span class="n">start_date</span>
    <span class="k">if</span> <span class="n">trading_start_date</span> <span class="o">&gt;=</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;trading_start_date must be before end_date&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">storage_max</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;storage_max must be &gt;= 0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lin_deg_cost</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;lin_deg_cost must be &gt;= 0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">loss_in</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">loss_in</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;loss_in must be in [0, 1]&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">loss_out</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">loss_out</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;loss_out must be in [0,1]&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">trading_fee</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;trading_fee must be &gt;= 0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_stor_states</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_stor_states must be &gt; 0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tec_delay</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tec_delay must be &gt;= 0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fixed_solve_time</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fixed_solve_time</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;fixed_solve_time must be &gt;= 0 (or -1 for realistic solve times)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">solve_frequency</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;solve_frequency must be &gt;= 0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">withdraw_max</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;withdraw_max must be &gt; 0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">inject_max</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;inject_max must be &gt; 0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">trading_delay</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">trading_delay</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="o">*</span><span class="mi">60</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;trading_delay must be &gt;= 0 and &lt; 480 mins (8 hours)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cycle_limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cycle_limit</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cycle_limit must be &gt; 0 if provided&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">min_hot_queue_size</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">min_hot_queue_size</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;min_hot_queue_size must be &gt; 0 or -1 (to disable)&quot;</span><span class="p">)</span>
    <span class="c1"># if forecast_horizon_start &lt; 0:</span>
    <span class="c1">#     raise ValueError(&quot;forecast_horizon_start must be &gt;= 0&quot;)</span>
    <span class="c1"># if forecast_horizon_end &lt; 0:</span>
    <span class="c1">#     raise ValueError(&quot;forecast_horizon_end must be &gt;= 0&quot;)</span>
    <span class="c1"># if forecast_horizon_start &lt;= forecast_horizon_end:</span>
    <span class="c1">#     raise ValueError(&quot;forecast_horizon_start must larger than forecast_horizon_end&quot;)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span> <span class="o">=</span> <span class="n">Simulation_cpp</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">storageMax</span> <span class="o">=</span> <span class="n">storage_max</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">linDegCost</span> <span class="o">=</span> <span class="n">lin_deg_cost</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">lossIn</span> <span class="o">=</span> <span class="n">loss_in</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">lossOut</span> <span class="o">=</span> <span class="n">loss_out</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingFee</span> <span class="o">=</span> <span class="n">trading_fee</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">numStorStates</span> <span class="o">=</span> <span class="n">num_stor_states</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pingDelay</span> <span class="o">=</span> <span class="n">tec_delay</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">fixedSolveTime</span> <span class="o">=</span> <span class="n">fixed_solve_time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dpFreq</span> <span class="o">=</span> <span class="n">solve_frequency</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">withdrawMax</span> <span class="o">=</span> <span class="n">withdraw_max</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">injectMax</span> <span class="o">=</span> <span class="n">inject_max</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">minuteDelay</span> <span class="o">=</span> <span class="n">trading_delay</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">logTransactions</span> <span class="o">=</span> <span class="n">log_transactions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">onlyTraverseLOB</span> <span class="o">=</span> <span class="n">only_traverse_lob</span>
    <span class="k">if</span> <span class="n">cycle_limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cycleLimit</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cycle_limit</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">minHotQueueSize</span> <span class="o">=</span> <span class="n">min_hot_queue_size</span>
    <span class="c1"># self._sim_cpp.params.foreHorizonStart = forecast_horizon_start</span>
    <span class="c1"># self._sim_cpp.params.foreHorizonEnd = forecast_horizon_end</span>

    <span class="c1"># Set start and end date</span>
    <span class="k">if</span> <span class="n">start_date</span> <span class="o">&gt;=</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;start_date must be before end_date&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">start_date</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;start_date must be timezone aware&quot;</span><span class="p">)</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startMonth</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">month</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startDay</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">day</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startYear</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">year</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startHour</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">hour</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startMinute</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">minute</span>
    <span class="k">if</span> <span class="n">end_date</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;end_date must be timezone aware&quot;</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endMonth</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">month</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endDay</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">day</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endYear</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">year</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endHour</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">hour</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endMinute</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">minute</span>

    <span class="c1"># Set trading start date</span>
    <span class="k">if</span> <span class="n">trading_start_date</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;trading_start_date must be timezone aware&quot;</span><span class="p">)</span>
    <span class="n">trading_start_date</span> <span class="o">=</span> <span class="n">trading_start_date</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartMonth</span> <span class="o">=</span> <span class="n">trading_start_date</span><span class="o">.</span><span class="n">month</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartDay</span> <span class="o">=</span> <span class="n">trading_start_date</span><span class="o">.</span><span class="n">day</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartYear</span> <span class="o">=</span> <span class="n">trading_start_date</span><span class="o">.</span><span class="n">year</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartHour</span> <span class="o">=</span> <span class="n">trading_start_date</span><span class="o">.</span><span class="n">hour</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartMinute</span> <span class="o">=</span> <span class="n">trading_start_date</span><span class="o">.</span><span class="n">minute</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.add_bin_to_orderqueue" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_bin_to_orderqueue</span><span class="p">(</span><span class="n">bin_data</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add an order binary file to the simulation's order queue.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bin_data</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the order binary file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_bin_to_orderqueue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_data</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add an order binary file to the simulation&#39;s order queue.</span>

<span class="sd">    Args:</span>
<span class="sd">        bin_data (str): The path to the order binary file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">addOrderQueueFromBin</span><span class="p">(</span><span class="n">bin_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.add_df_to_orderqueue" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_df_to_orderqueue</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add a DataFrame of orders to the simulation's order queue.</p>
<p>The DataFrame must have the same columns as the saved CSV files, with timestamps in UTC
(seconds and milliseconds).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A DataFrame containing the orders to be added.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="processing-steps" open>
  <summary>Processing Steps</summary>
  <ul>
<li>Validate that the timestamp columns ('start', 'transaction', 'validity') are timezone aware.</li>
<li>Ensure that all timestamps are in the same timezone.</li>
<li>Convert all timestamps to UTC and format them in ISO 8601.</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_df_to_orderqueue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a DataFrame of orders to the simulation&#39;s order queue.</span>

<span class="sd">    The DataFrame must have the same columns as the saved CSV files, with timestamps in UTC</span>
<span class="sd">    (seconds and milliseconds).</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): A DataFrame containing the orders to be added.</span>

<span class="sd">    Processing Steps:</span>
<span class="sd">        - Validate that the timestamp columns (&#39;start&#39;, &#39;transaction&#39;, &#39;validity&#39;) are timezone aware.</span>
<span class="sd">        - Ensure that all timestamps are in the same timezone.</span>
<span class="sd">        - Convert all timestamps to UTC and format them in ISO 8601.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;validity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All timestamps of input df must be timezone aware&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="ow">and</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;validity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All timestamps of input df must be in the same timezone&quot;</span><span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;validity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;validity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%SZ&#39;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Z&#39;</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;validity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;validity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Z&#39;</span>

    <span class="n">ids</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">initials</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;initial&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">sides</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">starts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">transactions</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">validities</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;validity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">prices</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">quantities</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">addOrderQueueFromPandas</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">initials</span><span class="p">,</span> <span class="n">sides</span><span class="p">,</span> <span class="n">starts</span><span class="p">,</span> <span class="n">transactions</span><span class="p">,</span> <span class="n">validities</span><span class="p">,</span> <span class="n">prices</span><span class="p">,</span> <span class="n">quantities</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.get_data_bins_for_each_day" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_data_bins_for_each_day</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate a list of file paths for binary order book data for each day within a date range.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>base_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The base directory path where the binary files are stored.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date</code>
            </td>
            <td>
                  <code><span title="pandas.Timestamp">Timestamp</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start date of the range.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date</code>
            </td>
            <td>
                  <code><span title="pandas.Timestamp">Timestamp</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end date of the range.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of file paths for each day's binary order book file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_data_bins_for_each_day</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a list of file paths for binary order book data for each day within a date range.</span>

<span class="sd">    Args:</span>
<span class="sd">        base_path (str): The base directory path where the binary files are stored.</span>
<span class="sd">        start_date (pd.Timestamp): The start date of the range.</span>
<span class="sd">        end_date (pd.Timestamp): The end date of the range.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of file paths for each day&#39;s binary order book file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># convert dates to utc time</span>
    <span class="n">start_date_berlin</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;Europe/Berlin&#39;</span><span class="p">)</span> <span class="c1"># convert to tz in which the lob files are segemented</span>
    <span class="n">end_date_berlin</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;Europe/Berlin&#39;</span><span class="p">)</span> <span class="c1"># convert to tz in which the lob files are segemented</span>

    <span class="c1"># round up to midnight</span>
    <span class="n">end_date_berlin_round_up</span> <span class="o">=</span> <span class="n">end_date_berlin</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">59</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">59</span><span class="p">)</span>

    <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">base_path</span> <span class="o">+=</span> <span class="s2">&quot;orderbook_&quot;</span>

    <span class="c1"># Generate paths for each day within the date range</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">current_date</span> <span class="o">=</span> <span class="n">start_date_berlin</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># include the day before the start date to ensure that all orders submitted with delivery on first day are included</span>
    <span class="k">while</span> <span class="n">current_date</span> <span class="o">&lt;</span> <span class="n">end_date_berlin_round_up</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_path</span><span class="si">}{</span><span class="n">current_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.bin&quot;</span>
        <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">current_date</span> <span class="o">+=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">paths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.get_last_order_placement_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_last_order_placement_time</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the simulation's current time (last processed order's placement time) as a UTC datetime.</p>
<p>This returns the internal <code>_lastOrder_placementTime</code> from the C++ simulation,
converted to a timezone-aware pandas Timestamp in UTC.</p>
<h4 id="bitepy.Simulation.get_last_order_placement_time--returns">Returns</h4>
<p>pd.Timestamp
    The timestamp of the last processed order's placement time in UTC.
    Returns pd.NaT if no orders have been processed yet (time is at minimum int64 value).</p>
<h4 id="bitepy.Simulation.get_last_order_placement_time--notes">Notes</h4>
<ul>
<li>The internal time is stored as milliseconds since epoch (Unix time)</li>
<li>This is the time used by methods like get_limit_order_book_state() and solve()</li>
<li>Before any orders are processed, this returns pd.NaT</li>
</ul>
<h4 id="bitepy.Simulation.get_last_order_placement_time--example">Example</h4>
<blockquote>
<blockquote>
<blockquote>
<p>sim.add_bin_to_orderqueue("path/to/data.bin")
sim.run_one_day(is_last=False)
current_time = sim.get_last_order_placement_time()
print(current_time)
2024-01-15 12:30:45.123000+00:00</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_last_order_placement_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the simulation&#39;s current time (last processed order&#39;s placement time) as a UTC datetime.</span>

<span class="sd">    This returns the internal `_lastOrder_placementTime` from the C++ simulation,</span>
<span class="sd">    converted to a timezone-aware pandas Timestamp in UTC.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.Timestamp</span>
<span class="sd">        The timestamp of the last processed order&#39;s placement time in UTC.</span>
<span class="sd">        Returns pd.NaT if no orders have been processed yet (time is at minimum int64 value).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The internal time is stored as milliseconds since epoch (Unix time)</span>
<span class="sd">    - This is the time used by methods like get_limit_order_book_state() and solve()</span>
<span class="sd">    - Before any orders are processed, this returns pd.NaT</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; sim.add_bin_to_orderqueue(&quot;path/to/data.bin&quot;)</span>
<span class="sd">    &gt;&gt;&gt; sim.run_one_day(is_last=False)</span>
<span class="sd">    &gt;&gt;&gt; current_time = sim.get_last_order_placement_time()</span>
<span class="sd">    &gt;&gt;&gt; print(current_time)</span>
<span class="sd">    2024-01-15 12:30:45.123000+00:00</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">getLastOrderPlacementTimeMs</span><span class="p">()</span>

    <span class="c1"># Handle uninitialized state (minimum int64 value)</span>
    <span class="c1"># In C++, it&#39;s initialized to std::numeric_limits&lt;int64_t&gt;::min()</span>
    <span class="k">if</span> <span class="n">time_ms</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

    <span class="c1"># Convert milliseconds since epoch to UTC timestamp</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">time_ms</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.get_limit_order_book_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_limit_order_book_state</span><span class="p">(</span><span class="n">max_action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the current state of all active limit order books at the last-set stop time.</p>
<p>This method returns, for each tradable product (delivery hour), the individual limit orders
in the buy and sell queues with all their attributes, up to a cumulative volume of max_action.
The query time is automatically set to the last-set stop time.</p>
<h4 id="bitepy.Simulation.get_limit_order_book_state--parameters">Parameters</h4>
<p>max_action : float, optional
    The maximum cumulative volume to query in MW (= MWh for 1-hour products).
    If None (default), uses inject_max + withdraw_max from simulation parameters.
    Must be &gt; 0 if specified.
return_dict : bool, optional
    Whether to return the limit order book state as a dictionary.
    If True, the return value is a dictionary with the delivery time as the key and the limit order book state as the value.
    If False (default), the return value is a DataFrame.</p>
<h4 id="bitepy.Simulation.get_limit_order_book_state--returns">Returns</h4>
<p>pd.DataFrame or dict
    A DataFrame containing the limit orders with the following columns:
        - delivery_time: The delivery time of the product (UTC timestamp)
        - side: 'sell' or 'buy' (sell orders are where you can buy from, buy orders are where you can sell to)
        - order_id: The unique order ID
        - initial_id: The initial order ID (for tracking order modifications)
        - start_time: When the order was placed (UTC timestamp)
        - cancel_time: When the order expires (UTC timestamp)
        - price: The limit order price in EUR/MWh
        - volume: The order volume in MWh
        - is_forecast: Whether this is a forecast order (bool)
        - cumulative_volume: The cumulative volume up to and including this order in MWh</p>
<h4 id="bitepy.Simulation.get_limit_order_book_state--notes">Notes</h4>
<ul>
<li>Uses the simulation's internal current time (_lastOrder_placementTime)</li>
<li>Sell orders are sorted by ascending price (cheapest first = best for buying)</li>
<li>Buy orders are sorted by descending price (highest first = best for selling)</li>
<li>Orders are filtered to exclude expired orders at the query time</li>
<li>Cumulative volume stops at max_action (default: inject_max + withdraw_max)</li>
<li>Each row represents one limit order in the order book</li>
</ul>
<h4 id="bitepy.Simulation.get_limit_order_book_state--example">Example</h4>
<blockquote>
<blockquote>
<blockquote>
<h3 id="bitepy.Simulation.get_limit_order_book_state--query-order-book-state-with-default-max_action-inject_max-withdraw_max">Query order book state with default max_action (inject_max + withdraw_max)</h3>
<p>lob_state = sim.get_limit_order_book_state()</p>
<h3 id="bitepy.Simulation.get_limit_order_book_state--query-with-custom-max_action">Query with custom max_action</h3>
<p>lob_state = sim.get_limit_order_book_state(max_action=20.0)</p>
<h3 id="bitepy.Simulation.get_limit_order_book_state--filter-to-see-sell-orders-for-a-specific-product">Filter to see sell orders for a specific product</h3>
<p>product_sells = lob_state[(lob_state['delivery_time'] == some_time) &amp; (lob_state['side'] == 'sell')]</p>
<h3 id="bitepy.Simulation.get_limit_order_book_state--see-the-best-cheapest-sell-price">See the best (cheapest) sell price</h3>
<p>best_sell_price = product_sells.iloc[0]['price']</p>
<h3 id="bitepy.Simulation.get_limit_order_book_state--filter-to-see-only-forecast-orders">Filter to see only forecast orders</h3>
<p>forecast_orders = lob_state[lob_state['is_forecast'] == True]</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_limit_order_book_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_action</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the current state of all active limit order books at the last-set stop time.</span>

<span class="sd">    This method returns, for each tradable product (delivery hour), the individual limit orders</span>
<span class="sd">    in the buy and sell queues with all their attributes, up to a cumulative volume of max_action.</span>
<span class="sd">    The query time is automatically set to the last-set stop time.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    max_action : float, optional</span>
<span class="sd">        The maximum cumulative volume to query in MW (= MWh for 1-hour products).</span>
<span class="sd">        If None (default), uses inject_max + withdraw_max from simulation parameters.</span>
<span class="sd">        Must be &gt; 0 if specified.</span>
<span class="sd">    return_dict : bool, optional</span>
<span class="sd">        Whether to return the limit order book state as a dictionary.</span>
<span class="sd">        If True, the return value is a dictionary with the delivery time as the key and the limit order book state as the value.</span>
<span class="sd">        If False (default), the return value is a DataFrame.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame or dict</span>
<span class="sd">        A DataFrame containing the limit orders with the following columns:</span>
<span class="sd">            - delivery_time: The delivery time of the product (UTC timestamp)</span>
<span class="sd">            - side: &#39;sell&#39; or &#39;buy&#39; (sell orders are where you can buy from, buy orders are where you can sell to)</span>
<span class="sd">            - order_id: The unique order ID</span>
<span class="sd">            - initial_id: The initial order ID (for tracking order modifications)</span>
<span class="sd">            - start_time: When the order was placed (UTC timestamp)</span>
<span class="sd">            - cancel_time: When the order expires (UTC timestamp)</span>
<span class="sd">            - price: The limit order price in EUR/MWh</span>
<span class="sd">            - volume: The order volume in MWh</span>
<span class="sd">            - is_forecast: Whether this is a forecast order (bool)</span>
<span class="sd">            - cumulative_volume: The cumulative volume up to and including this order in MWh</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Uses the simulation&#39;s internal current time (_lastOrder_placementTime)</span>
<span class="sd">    - Sell orders are sorted by ascending price (cheapest first = best for buying)</span>
<span class="sd">    - Buy orders are sorted by descending price (highest first = best for selling)</span>
<span class="sd">    - Orders are filtered to exclude expired orders at the query time</span>
<span class="sd">    - Cumulative volume stops at max_action (default: inject_max + withdraw_max)</span>
<span class="sd">    - Each row represents one limit order in the order book</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; # Query order book state with default max_action (inject_max + withdraw_max)</span>
<span class="sd">    &gt;&gt;&gt; lob_state = sim.get_limit_order_book_state()</span>
<span class="sd">    &gt;&gt;&gt; # Query with custom max_action</span>
<span class="sd">    &gt;&gt;&gt; lob_state = sim.get_limit_order_book_state(max_action=20.0)</span>
<span class="sd">    &gt;&gt;&gt; # Filter to see sell orders for a specific product</span>
<span class="sd">    &gt;&gt;&gt; product_sells = lob_state[(lob_state[&#39;delivery_time&#39;] == some_time) &amp; (lob_state[&#39;side&#39;] == &#39;sell&#39;)]</span>
<span class="sd">    &gt;&gt;&gt; # See the best (cheapest) sell price</span>
<span class="sd">    &gt;&gt;&gt; best_sell_price = product_sells.iloc[0][&#39;price&#39;]</span>
<span class="sd">    &gt;&gt;&gt; # Filter to see only forecast orders</span>
<span class="sd">    &gt;&gt;&gt; forecast_orders = lob_state[lob_state[&#39;is_forecast&#39;] == True]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Determine max_action value</span>
    <span class="k">if</span> <span class="n">max_action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Use inject_max + withdraw_max as default</span>
        <span class="n">max_action_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">injectMax</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">withdrawMax</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Validate that max_action is positive</span>
        <span class="k">if</span> <span class="n">max_action</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_action must be &gt; 0&quot;</span><span class="p">)</span>
        <span class="n">max_action_value</span> <span class="o">=</span> <span class="n">max_action</span>

    <span class="c1"># Call C++ function (uses simulation&#39;s current time internally)</span>
    <span class="n">lob_state_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">getLimitOrderBookState</span><span class="p">(</span><span class="n">max_action_value</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lob_state_dict</span>

    <span class="c1"># Convert to DataFrame</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">delivery_time_ms</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">lob_state_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">delivery_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">delivery_time_ms</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>

        <span class="c1"># Process sell orders (where we can buy from)</span>
        <span class="n">sell_ids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sell_ids&#39;</span><span class="p">]</span>
        <span class="n">sell_initial_ids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sell_initial_ids&#39;</span><span class="p">]</span>
        <span class="n">sell_starts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sell_starts&#39;</span><span class="p">]</span>
        <span class="n">sell_cancels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sell_cancels&#39;</span><span class="p">]</span>
        <span class="n">sell_prices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sell_prices&#39;</span><span class="p">]</span>
        <span class="n">sell_volumes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sell_volumes&#39;</span><span class="p">]</span>
        <span class="n">sell_forecasts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sell_forecasts&#39;</span><span class="p">]</span>

        <span class="n">cumulative_sell_volume</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">order_id</span><span class="p">,</span> <span class="n">initial_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">cancel</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">forecast</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">sell_ids</span><span class="p">,</span> <span class="n">sell_initial_ids</span><span class="p">,</span> <span class="n">sell_starts</span><span class="p">,</span> <span class="n">sell_cancels</span><span class="p">,</span> <span class="n">sell_prices</span><span class="p">,</span> <span class="n">sell_volumes</span><span class="p">,</span> <span class="n">sell_forecasts</span>
        <span class="p">):</span>
            <span class="n">cumulative_sell_volume</span> <span class="o">+=</span> <span class="n">volume</span>
            <span class="c1"># Handle sentinel cancel time values (e.g., max int64) that overflow pandas timestamps</span>
            <span class="n">cancel_ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">cancel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">value</span> <span class="o">//</span> <span class="mi">1_000_000</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cancel</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;delivery_time&#39;</span><span class="p">:</span> <span class="n">delivery_time</span><span class="p">,</span>
                <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="s1">&#39;sell&#39;</span><span class="p">,</span>
                <span class="s1">&#39;order_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">),</span>
                <span class="s1">&#39;initial_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">initial_id</span><span class="p">),</span>
                <span class="s1">&#39;start_time&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">),</span>
                <span class="s1">&#39;cancel_time&#39;</span><span class="p">:</span> <span class="n">cancel_ts</span><span class="p">,</span>
                <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="n">price</span><span class="p">,</span>
                <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="n">volume</span><span class="p">,</span>
                <span class="s1">&#39;is_forecast&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">forecast</span><span class="p">),</span>
                <span class="s1">&#39;cumulative_volume&#39;</span><span class="p">:</span> <span class="n">cumulative_sell_volume</span>
            <span class="p">})</span>

        <span class="c1"># Process buy orders (where we can sell to)</span>
        <span class="n">buy_ids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buy_ids&#39;</span><span class="p">]</span>
        <span class="n">buy_initial_ids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buy_initial_ids&#39;</span><span class="p">]</span>
        <span class="n">buy_starts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buy_starts&#39;</span><span class="p">]</span>
        <span class="n">buy_cancels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buy_cancels&#39;</span><span class="p">]</span>
        <span class="n">buy_prices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buy_prices&#39;</span><span class="p">]</span>
        <span class="n">buy_volumes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buy_volumes&#39;</span><span class="p">]</span>
        <span class="n">buy_forecasts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buy_forecasts&#39;</span><span class="p">]</span>

        <span class="n">cumulative_buy_volume</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">order_id</span><span class="p">,</span> <span class="n">initial_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">cancel</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">forecast</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">buy_ids</span><span class="p">,</span> <span class="n">buy_initial_ids</span><span class="p">,</span> <span class="n">buy_starts</span><span class="p">,</span> <span class="n">buy_cancels</span><span class="p">,</span> <span class="n">buy_prices</span><span class="p">,</span> <span class="n">buy_volumes</span><span class="p">,</span> <span class="n">buy_forecasts</span>
        <span class="p">):</span>
            <span class="n">cumulative_buy_volume</span> <span class="o">+=</span> <span class="n">volume</span>
            <span class="c1"># Handle sentinel cancel time values (e.g., max int64) that overflow pandas timestamps</span>
            <span class="n">cancel_ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">cancel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">value</span> <span class="o">//</span> <span class="mi">1_000_000</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cancel</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;delivery_time&#39;</span><span class="p">:</span> <span class="n">delivery_time</span><span class="p">,</span>
                <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="s1">&#39;buy&#39;</span><span class="p">,</span>
                <span class="s1">&#39;order_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">),</span>
                <span class="s1">&#39;initial_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">initial_id</span><span class="p">),</span>
                <span class="s1">&#39;start_time&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">),</span>
                <span class="s1">&#39;cancel_time&#39;</span><span class="p">:</span> <span class="n">cancel_ts</span><span class="p">,</span>
                <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="n">price</span><span class="p">,</span>
                <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="n">volume</span><span class="p">,</span>
                <span class="s1">&#39;is_forecast&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">forecast</span><span class="p">),</span>
                <span class="s1">&#39;cumulative_volume&#39;</span><span class="p">:</span> <span class="n">cumulative_buy_volume</span>
            <span class="p">})</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.get_limit_order_matches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_limit_order_matches</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the limit order matches collected during simulation using the forecast tracking mechanism.</p>
<p>This method retrieves match information for submitted limit orders that were processed
during the simulation run. The orders are tracked using the forecast flag system.</p>


<details class="processing-steps" open>
  <summary>Processing Steps</summary>
  <ul>
<li>Retrieves match data from the C++ simulation backend.</li>
<li>Converts timestamps to timezone-aware datetime objects.</li>
<li>Clears the internal match storage after retrieval.</li>
</ul>
</details>

    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: A DataFrame containing information about which limit orders were matched against which existing orders.
The DataFrame contains the following columns:
    - submitted_order_id: The ID of the submitted limit order.
    - matched_order_id: The ID of the existing order that was matched.
    - match_timestamp: The timestamp when the match occurred.
    - delivery_hour: The delivery hour for the matched order.
    - match_price: The price at which the orders were matched, i.e., the price of the existing (partially) matched order (/MWh).
    - match_volume: The volume that was matched (MWh).
    - submitted_order_side: The side of the submitted order ('buy' or 'sell').
    - existing_order_side: The side of the existing order ('buy' or 'sell').</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_limit_order_matches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the limit order matches collected during simulation using the forecast tracking mechanism.</span>

<span class="sd">    This method retrieves match information for submitted limit orders that were processed</span>
<span class="sd">    during the simulation run. The orders are tracked using the forecast flag system.</span>

<span class="sd">    Processing Steps:</span>
<span class="sd">        - Retrieves match data from the C++ simulation backend.</span>
<span class="sd">        - Converts timestamps to timezone-aware datetime objects.</span>
<span class="sd">        - Clears the internal match storage after retrieval.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing information about which limit orders were matched against which existing orders.</span>
<span class="sd">            The DataFrame contains the following columns:</span>
<span class="sd">                - submitted_order_id: The ID of the submitted limit order.</span>
<span class="sd">                - matched_order_id: The ID of the existing order that was matched.</span>
<span class="sd">                - match_timestamp: The timestamp when the match occurred.</span>
<span class="sd">                - delivery_hour: The delivery hour for the matched order.</span>
<span class="sd">                - match_price: The price at which the orders were matched, i.e., the price of the existing (partially) matched order (/MWh).</span>
<span class="sd">                - match_volume: The volume that was matched (MWh).</span>
<span class="sd">                - submitted_order_side: The side of the submitted order (&#39;buy&#39; or &#39;sell&#39;).</span>
<span class="sd">                - existing_order_side: The side of the existing order (&#39;buy&#39; or &#39;sell&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">getLimitOrderMatches</span><span class="p">()</span>
    <span class="n">matches_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>

    <span class="c1"># Convert timestamps to datetime if not empty</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">matches_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">matches_df</span><span class="p">[</span><span class="s2">&quot;match_timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">matches_df</span><span class="p">[</span><span class="s2">&quot;match_timestamp&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">matches_df</span><span class="p">[</span><span class="s2">&quot;delivery_hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">matches_df</span><span class="p">[</span><span class="s2">&quot;delivery_hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No limit order matches to return.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">clearLimitOrderMatches</span><span class="p">()</span> <span class="c1"># clear existing matches</span>

    <span class="k">return</span> <span class="n">matches_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.get_logs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_logs</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieve the logs generated by the simulation.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing simulation logs with the following keys:
- decision_record: Final simulation schedule.
- price_record: CID price data over the simulation duration.
- accepted_orders: Limit orders accepted by the RI.
- executed_orders: Orders sent to the exchange by the RI.
- killed_orders: Orders that were missed at the exchange.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the logs generated by the simulation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing simulation logs with the following keys:</span>
<span class="sd">            - decision_record: Final simulation schedule.</span>
<span class="sd">            - price_record: CID price data over the simulation duration.</span>
<span class="sd">            - accepted_orders: Limit orders accepted by the RI.</span>
<span class="sd">            - executed_orders: Orders sent to the exchange by the RI.</span>
<span class="sd">            - killed_orders: Orders that were missed at the exchange.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># - forecast_orders: Orders virtually traded against the forecast.</span>
    <span class="c1"># - balancing_orders: Orders that would have incurred payments to the TSO.</span>
    <span class="n">decision_record</span><span class="p">,</span> <span class="n">price_record</span><span class="p">,</span> <span class="n">accepted_orders</span><span class="p">,</span> <span class="n">executed_orders</span><span class="p">,</span> <span class="n">forecast_orders</span><span class="p">,</span> <span class="n">killed_orders</span><span class="p">,</span> <span class="n">balancing_orders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">getLogs</span><span class="p">()</span>
    <span class="n">decision_record</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">decision_record</span><span class="p">)</span>
    <span class="n">price_record</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">price_record</span><span class="p">)</span>
    <span class="n">accepted_orders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">accepted_orders</span><span class="p">)</span>
    <span class="n">executed_orders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">executed_orders</span><span class="p">)</span>
    <span class="n">forecast_orders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">forecast_orders</span><span class="p">)</span>
    <span class="n">killed_orders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">killed_orders</span><span class="p">)</span>
    <span class="n">balancing_orders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">balancing_orders</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">decision_record</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">decision_record</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">decision_record</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">decision_record</span><span class="p">[</span><span class="s2">&quot;cycles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decision_record</span><span class="p">[</span><span class="s2">&quot;cycles&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">price_record</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">price_record</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">price_record</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">accepted_orders</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;cancel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;cancel&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;delivery&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">accepted_orders</span><span class="p">[</span><span class="s2">&quot;delivery&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">executed_orders</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">executed_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">executed_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">executed_orders</span><span class="p">[</span><span class="s2">&quot;last_solve_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">executed_orders</span><span class="p">[</span><span class="s2">&quot;last_solve_time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">executed_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">executed_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">forecast_orders</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">forecast_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">forecast_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">forecast_orders</span><span class="p">[</span><span class="s2">&quot;last_solve_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">forecast_orders</span><span class="p">[</span><span class="s2">&quot;last_solve_time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">forecast_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">forecast_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">killed_orders</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">killed_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">killed_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">killed_orders</span><span class="p">[</span><span class="s2">&quot;last_solve_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">killed_orders</span><span class="p">[</span><span class="s2">&quot;last_solve_time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">killed_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">killed_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">balancing_orders</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">balancing_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">balancing_orders</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">balancing_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">balancing_orders</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">logs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;decision_record&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">decision_record</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
        <span class="s2">&quot;price_record&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">price_record</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
        <span class="s2">&quot;accepted_orders&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">accepted_orders</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
        <span class="s2">&quot;executed_orders&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">executed_orders</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
        <span class="c1"># &quot;forecast_orders&quot;: pd.DataFrame(forecast_orders, index=None), # removed for later versions of the code</span>
        <span class="s2">&quot;killed_orders&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">killed_orders</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
        <span class="c1"># &quot;balancing_orders&quot;: pd.DataFrame(balancing_orders, index=None), # removed for later versions of the code</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">logs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.get_next_order_start_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_next_order_start_time</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the order queue's next order start time as a UTC datetime.</p>
<p>This peeks at the next order in the queue without consuming it, returning
its start time (placement time) converted to a timezone-aware pandas Timestamp in UTC.</p>
<h4 id="bitepy.Simulation.get_next_order_start_time--returns">Returns</h4>
<p>pd.Timestamp
    The timestamp of the next order's start time in UTC.
    Returns pd.NaT if no more orders are available in the queue.</p>
<h4 id="bitepy.Simulation.get_next_order_start_time--notes">Notes</h4>
<ul>
<li>The internal time is stored as milliseconds since epoch (Unix time)</li>
<li>This does not advance the order queue; it only peeks at the next order</li>
<li>Useful for determining when the next order will be processed</li>
</ul>
<h4 id="bitepy.Simulation.get_next_order_start_time--example">Example</h4>
<blockquote>
<blockquote>
<blockquote>
<p>sim.add_bin_to_orderqueue("path/to/data.bin")
next_time = sim.get_next_order_start_time()
print(next_time)
2024-01-15 12:30:45.123000+00:00</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_next_order_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the order queue&#39;s next order start time as a UTC datetime.</span>

<span class="sd">    This peeks at the next order in the queue without consuming it, returning</span>
<span class="sd">    its start time (placement time) converted to a timezone-aware pandas Timestamp in UTC.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.Timestamp</span>
<span class="sd">        The timestamp of the next order&#39;s start time in UTC.</span>
<span class="sd">        Returns pd.NaT if no more orders are available in the queue.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The internal time is stored as milliseconds since epoch (Unix time)</span>
<span class="sd">    - This does not advance the order queue; it only peeks at the next order</span>
<span class="sd">    - Useful for determining when the next order will be processed</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; sim.add_bin_to_orderqueue(&quot;path/to/data.bin&quot;)</span>
<span class="sd">    &gt;&gt;&gt; next_time = sim.get_next_order_start_time()</span>
<span class="sd">    &gt;&gt;&gt; print(next_time)</span>
<span class="sd">    2024-01-15 12:30:45.123000+00:00</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">getNextOrderStartTimeMs</span><span class="p">()</span>

    <span class="c1"># Handle case when no next order exists (minimum int64 value)</span>
    <span class="k">if</span> <span class="n">time_ms</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

    <span class="c1"># Convert milliseconds since epoch to UTC timestamp</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">time_ms</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.get_transactions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_transactions</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieve all transactions that have occurred since the last call and clear the internal transaction log.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: A DataFrame containing all transactions that occurred, with the following columns:
- timestamp: The UTC timestamp when the transaction occurred.
- delivery_hour: The UTC timestamp of the delivery hour for the traded product.
- price: The execution price of the transaction (EUR/MWh).
- volume: The volume of the transaction (MW).
- buy_order_type: The type of the buy order ('Market' or 'Limit').
- sell_order_type: The type of the sell order ('Market' or 'Limit').
- buy_order_id: The ID of the buy order.
- sell_order_id: The ID of the sell order.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_transactions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve all transactions that have occurred since the last call and clear the internal transaction log.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing all transactions that occurred, with the following columns:</span>
<span class="sd">            - timestamp: The UTC timestamp when the transaction occurred.</span>
<span class="sd">            - delivery_hour: The UTC timestamp of the delivery hour for the traded product.</span>
<span class="sd">            - price: The execution price of the transaction (EUR/MWh).</span>
<span class="sd">            - volume: The volume of the transaction (MW).</span>
<span class="sd">            - buy_order_type: The type of the buy order (&#39;Market&#39; or &#39;Limit&#39;).</span>
<span class="sd">            - sell_order_type: The type of the sell order (&#39;Market&#39; or &#39;Limit&#39;).</span>
<span class="sd">            - buy_order_id: The ID of the buy order.</span>
<span class="sd">            - sell_order_id: The ID of the sell order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transactions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">getTransactions</span><span class="p">()</span>
    <span class="n">transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">transactions</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">transactions</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">transactions</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">transactions</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">transactions</span><span class="p">[</span><span class="s2">&quot;delivery_hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">transactions</span><span class="p">[</span><span class="s2">&quot;delivery_hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">transactions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.group_transactions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">group_transactions</span><span class="p">(</span><span class="n">transactions</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Group transactions by timestamp and delivery hour, calculating volume-weighted average prices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>transactions</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A DataFrame containing the transactions to be grouped.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="processing-steps" open>
  <summary>Processing Steps</summary>
  <ul>
<li>Group the transactions by timestamp and delivery_hour.</li>
<li>Calculate the volume weighted average price for each group.</li>
<li>Return a DataFrame with aggregated transaction data.</li>
</ul>
</details>

    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: A DataFrame with the following columns:
- timestamp: The UTC timestamp when the transaction occurred.
- delivery_hour: The UTC timestamp of the delivery hour for the traded product.
- vwap: The volume weighted average price of the transaction.
- total_volume: The total volume of the transaction.
- num_transactions: The number of transactions in the group.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">group_transactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transactions</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Group transactions by timestamp and delivery hour, calculating volume-weighted average prices.</span>

<span class="sd">    Args:</span>
<span class="sd">        transactions (pd.DataFrame): A DataFrame containing the transactions to be grouped.</span>

<span class="sd">    Processing Steps:</span>
<span class="sd">        - Group the transactions by timestamp and delivery_hour.</span>
<span class="sd">        - Calculate the volume weighted average price for each group.</span>
<span class="sd">        - Return a DataFrame with aggregated transaction data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame with the following columns:</span>
<span class="sd">            - timestamp: The UTC timestamp when the transaction occurred.</span>
<span class="sd">            - delivery_hour: The UTC timestamp of the delivery hour for the traded product.</span>
<span class="sd">            - vwap: The volume weighted average price of the transaction.</span>
<span class="sd">            - total_volume: The total volume of the transaction.</span>
<span class="sd">            - num_transactions: The number of transactions in the group.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">vwap_results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Group by timestamp and delivery_hour</span>
    <span class="n">grouped</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;delivery_hour&#39;</span><span class="p">])</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">delivery_hour</span><span class="p">),</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Single transaction - use price and volume directly</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">vwap</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
            <span class="n">total_volume</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Multiple transactions - calculate volume weighted average price</span>
            <span class="n">total_volume</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">weighted_price_sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">vwap</span> <span class="o">=</span> <span class="n">weighted_price_sum</span> <span class="o">/</span> <span class="n">total_volume</span> <span class="k">if</span> <span class="n">total_volume</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="n">vwap_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
            <span class="s1">&#39;delivery_hour&#39;</span><span class="p">:</span> <span class="n">delivery_hour</span><span class="p">,</span>
            <span class="s1">&#39;vwap&#39;</span><span class="p">:</span> <span class="n">vwap</span><span class="p">,</span>
            <span class="s1">&#39;total_volume&#39;</span><span class="p">:</span> <span class="n">total_volume</span><span class="p">,</span>
            <span class="s1">&#39;num_transactions&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="p">})</span>

    <span class="k">if</span> <span class="n">vwap_results</span><span class="p">:</span>
        <span class="n">vwap_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">vwap_results</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vwap_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">vwap_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.has_orders_remaining" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">has_orders_remaining</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if there are remaining orders in the order queue.</p>
<h4 id="bitepy.Simulation.has_orders_remaining--returns">Returns</h4>
<p>bool
    True if there are remaining orders in the queue, False otherwise.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">has_orders_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if there are remaining orders in the order queue.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if there are remaining orders in the queue, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">hasOrdersRemaining</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.has_stopped_at_stop_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">has_stopped_at_stop_time</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if the simulation has stopped due to the stop time being reached. Is set to false again once we set a new stop time.</p>
<h4 id="bitepy.Simulation.has_stopped_at_stop_time--returns">Returns</h4>
<p>bool
    True if the simulation stopped because the last order's submission time
    exceeded the set stop time. False otherwise.</p>
<h4 id="bitepy.Simulation.has_stopped_at_stop_time--notes">Notes</h4>
<ul>
<li>This flag is set when the simulation stops due to a stop time set via set_stop_time()</li>
<li>The flag is automatically reset when a new stop time is set</li>
<li>Use this to determine if a simulation pause was due to the stop time condition</li>
</ul>
<h4 id="bitepy.Simulation.has_stopped_at_stop_time--example">Example</h4>
<blockquote>
<blockquote>
<blockquote>
<p>sim.set_stop_time(pd.Timestamp('2024-01-15 12:30:00', tz='UTC'))
sim.run_one_day(is_last=False)
if sim.has_stopped_at_stop_time():
...     print("Simulation stopped at the specified stop time")</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">has_stopped_at_stop_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the simulation has stopped due to the stop time being reached. Is set to false again once we set a new stop time.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if the simulation stopped because the last order&#39;s submission time</span>
<span class="sd">        exceeded the set stop time. False otherwise.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - This flag is set when the simulation stops due to a stop time set via set_stop_time()</span>
<span class="sd">    - The flag is automatically reset when a new stop time is set</span>
<span class="sd">    - Use this to determine if a simulation pause was due to the stop time condition</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; sim.set_stop_time(pd.Timestamp(&#39;2024-01-15 12:30:00&#39;, tz=&#39;UTC&#39;))</span>
<span class="sd">    &gt;&gt;&gt; sim.run_one_day(is_last=False)</span>
<span class="sd">    &gt;&gt;&gt; if sim.has_stopped_at_stop_time():</span>
<span class="sd">    ...     print(&quot;Simulation stopped at the specified stop time&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">hasStoppedAtStopTime</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.print_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">print_parameters</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Print the simulation parameters, including start/end times, storage settings, and various limits and costs.</p>


<details class="processing-steps" open>
  <summary>Processing Steps</summary>
  <ul>
<li>Extract simulation start, end, and trading start times from internal parameters.</li>
<li>Display all relevant storage configuration parameters.</li>
<li>Show trading and technical constraints.</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">print_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print the simulation parameters, including start/end times, storage settings, and various limits and costs.</span>

<span class="sd">    Processing Steps:</span>
<span class="sd">        - Extract simulation start, end, and trading start times from internal parameters.</span>
<span class="sd">        - Display all relevant storage configuration parameters.</span>
<span class="sd">        - Show trading and technical constraints.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">startMonth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startMonth</span>
    <span class="n">startDay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startDay</span>
    <span class="n">startYear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startYear</span>
    <span class="n">startHour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startHour</span>
    <span class="n">startMinute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startMinute</span>
    <span class="n">endMonth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endMonth</span>
    <span class="n">endDay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endDay</span>
    <span class="n">endYear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endYear</span>
    <span class="n">endHour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endHour</span>
    <span class="n">endMinute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endMinute</span>
    <span class="n">tradingStartMonth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartMonth</span>
    <span class="n">tradingStartDay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartDay</span>
    <span class="n">tradingStartYear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartYear</span>
    <span class="n">tradingStartHour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartHour</span>
    <span class="n">tradingStartMinute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingStartMinute</span>
    <span class="n">cycleLimit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cycleLimit</span>

    <span class="n">startDate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">startYear</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="n">startMonth</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="n">startDay</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="n">startHour</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="n">startMinute</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
    <span class="n">endDate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">endYear</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="n">endMonth</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="n">endDay</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="n">endHour</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="n">endMinute</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
    <span class="n">tradingStartDate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">tradingStartYear</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="n">tradingStartMonth</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="n">tradingStartDay</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="n">tradingStartHour</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="n">tradingStartMinute</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start Time (UTC):&quot;</span><span class="p">,</span> <span class="n">startDate</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;End Time (UTC):&quot;</span><span class="p">,</span> <span class="n">endDate</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trading Start Time (UTC):&quot;</span><span class="p">,</span> <span class="n">tradingStartDate</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Storage Maximum:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">storageMax</span><span class="p">,</span> <span class="s2">&quot;MWh&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Linear Degredation Cost:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">linDegCost</span><span class="p">,</span> <span class="s2">&quot;/MWh&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Injection Loss +:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">lossIn</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Withdrawal Loss -:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">lossOut</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trading Fee:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tradingFee</span><span class="p">,</span> <span class="s2">&quot;/MWh&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of DP Storage States:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">numStorStates</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Technical Delay:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pingDelay</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trading Delay:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">minuteDelay</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fixed Solve Time:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">fixedSolveTime</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Solve Frequency:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dpFreq</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Injection Maximum:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">injectMax</span><span class="p">,</span> <span class="s2">&quot;MW&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Withdrawal Maximum:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">withdrawMax</span><span class="p">,</span> <span class="s2">&quot;MW&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Log Transactions:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">logTransactions</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Only Traverse LOB:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">onlyTraverseLOB</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cycle Limit:&quot;</span><span class="p">,</span> <span class="n">cycleLimit</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.reached_end_of_day" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reached_end_of_day</span><span class="p">(</span><span class="n">is_last</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if the order queue has reached the end for this day.</p>
<p>This function mirrors the logic of run_one_day(is_last) for checking
whether we've processed all available orders in the current batch.</p>
<h4 id="bitepy.Simulation.reached_end_of_day--parameters">Parameters</h4>
<p>is_last : bool
    Whether this is the last data batch (same semantics as run_one_day).
    - If False: indicates more data-days will be loaded after this batch
    - If True: indicates this is the final batch of data-days for this simulation</p>
<h4 id="bitepy.Simulation.reached_end_of_day--returns">Returns</h4>
<p>bool
    True if there are no more orders to process in the queue, False otherwise.</p>
<h4 id="bitepy.Simulation.reached_end_of_day--notes">Notes</h4>
<ul>
<li>Returns True when orderQueue.hasNext() is False in C++</li>
<li>The is_last parameter is kept for API consistency with run_one_day</li>
<li>Use this to check if the simulation stopped because it ran out of orders
  vs. stopping due to a stop time or stop hour</li>
</ul>
<h4 id="bitepy.Simulation.reached_end_of_day--example">Example</h4>
<blockquote>
<blockquote>
<blockquote>
<p>sim.run_one_day(is_last=False)
if sim.reached_end_of_day(is_last=False):
...     print("Processed all orders in current batch, ready for next day's data")
elif sim.has_stopped_at_stop_time():
...     print("Stopped at specified stop time")</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reached_end_of_day</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_last</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the order queue has reached the end for this day.</span>

<span class="sd">    This function mirrors the logic of run_one_day(is_last) for checking</span>
<span class="sd">    whether we&#39;ve processed all available orders in the current batch.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    is_last : bool</span>
<span class="sd">        Whether this is the last data batch (same semantics as run_one_day).</span>
<span class="sd">        - If False: indicates more data-days will be loaded after this batch</span>
<span class="sd">        - If True: indicates this is the final batch of data-days for this simulation</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if there are no more orders to process in the queue, False otherwise.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Returns True when orderQueue.hasNext() is False in C++</span>
<span class="sd">    - The is_last parameter is kept for API consistency with run_one_day</span>
<span class="sd">    - Use this to check if the simulation stopped because it ran out of orders</span>
<span class="sd">      vs. stopping due to a stop time or stop hour</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; sim.run_one_day(is_last=False)</span>
<span class="sd">    &gt;&gt;&gt; if sim.reached_end_of_day(is_last=False):</span>
<span class="sd">    ...     print(&quot;Processed all orders in current batch, ready for next day&#39;s data&quot;)</span>
<span class="sd">    &gt;&gt;&gt; elif sim.has_stopped_at_stop_time():</span>
<span class="sd">    ...     print(&quot;Stopped at specified stop time&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">reachedEndOfDay</span><span class="p">(</span><span class="n">is_last</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.return_vol_price_pairs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">return_vol_price_pairs</span><span class="p">(</span><span class="n">is_last</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">volumes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieve volume-price pairs from the simulation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>is_last</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, indicates this is the last iteration of data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frequency</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The frequency (in seconds) at which price data is retrieved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>volumes</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 1D numpy array of volumes for which prices are returned.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="processing-steps" open>
  <summary>Processing Steps</summary>
  <ul>
<li>Validate input parameters for correct format and values.</li>
<li>Extract volume-price data from the simulation at specified frequency.</li>
<li>Convert timestamps to UTC format for consistency.</li>
</ul>
</details>

    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: A DataFrame with columns:
- current_time: Time of the export (UTC).
- delivery_hour: Delivery period time (UTC).
- volume: The volume for which the price is exported (MWh).
- price_full: The full price (cashflow) for the volume ().
- worst_accepted_price: Market price of the worst matched order (/MWh).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">return_vol_price_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_last</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">frequency</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">volumes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve volume-price pairs from the simulation.</span>

<span class="sd">    Args:</span>
<span class="sd">        is_last (bool): If True, indicates this is the last iteration of data.</span>
<span class="sd">        frequency (int): The frequency (in seconds) at which price data is retrieved.</span>
<span class="sd">        volumes (np.ndarray): A 1D numpy array of volumes for which prices are returned.</span>

<span class="sd">    Processing Steps:</span>
<span class="sd">        - Validate input parameters for correct format and values.</span>
<span class="sd">        - Extract volume-price data from the simulation at specified frequency.</span>
<span class="sd">        - Convert timestamps to UTC format for consistency.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame with columns:</span>
<span class="sd">            - current_time: Time of the export (UTC).</span>
<span class="sd">            - delivery_hour: Delivery period time (UTC).</span>
<span class="sd">            - volume: The volume for which the price is exported (MWh).</span>
<span class="sd">            - price_full: The full price (cashflow) for the volume ().</span>
<span class="sd">            - worst_accepted_price: Market price of the worst matched order (/MWh).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;volumes must be a 1D numpy array&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">frequency</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;frequency must be &gt; 0&quot;</span><span class="p">)</span>

    <span class="n">vol_price_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">return_vol_price_pairs</span><span class="p">(</span><span class="n">is_last</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">volumes</span><span class="p">)</span>
    <span class="n">vol_price_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">vol_price_list</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">vol_price_list</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">vol_price_list</span><span class="p">[</span><span class="s2">&quot;current_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">vol_price_list</span><span class="p">[</span><span class="s2">&quot;current_time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">vol_price_list</span><span class="p">[</span><span class="s2">&quot;delivery_hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">vol_price_list</span><span class="p">[</span><span class="s2">&quot;delivery_hour&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">vol_price_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Execute the simulation using binary data files.</p>
<p>The files must be named as: orderbook_YYYY-MM-DD.bin.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory containing the binary data files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, display progress logs. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="processing-steps" open>
  <summary>Processing Steps</summary>
  <ul>
<li>Retrieve the list of binary file paths for the simulation period.</li>
<li>Iterate through each day's data, add the file to the order queue, and run the simulation for that day.</li>
</ul>
</details>

    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: A DataFrame containing the transactions if log_transactions is True, otherwise None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute the simulation using binary data files.</span>

<span class="sd">    The files must be named as: orderbook_YYYY-MM-DD.bin.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_path (str): The directory containing the binary data files.</span>
<span class="sd">        verbose (bool, optional): If True, display progress logs. Default is True.</span>

<span class="sd">    Processing Steps:</span>
<span class="sd">        - Retrieve the list of binary file paths for the simulation period.</span>
<span class="sd">        - Iterate through each day&#39;s data, add the file to the order queue, and run the simulation for that day.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing the transactions if log_transactions is True, otherwise None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startYear</span><span class="p">,</span>
                              <span class="n">month</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startMonth</span><span class="p">,</span>
                              <span class="n">day</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startDay</span><span class="p">,</span>
                              <span class="n">hour</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startHour</span><span class="p">,</span>
                              <span class="n">minute</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">startMinute</span><span class="p">,</span>
                              <span class="n">tz</span><span class="o">=</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endYear</span><span class="p">,</span>
                            <span class="n">month</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endMonth</span><span class="p">,</span>
                            <span class="n">day</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endDay</span><span class="p">,</span>
                            <span class="n">hour</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endHour</span><span class="p">,</span>
                            <span class="n">minute</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">endMinute</span><span class="p">,</span>
                            <span class="n">tz</span><span class="o">=</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
    <span class="n">lob_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_bins_for_each_day</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>

    <span class="n">transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="n">num_days</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lob_paths</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The simulation will iterate over&quot;</span><span class="p">,</span> <span class="n">num_days</span><span class="p">,</span> <span class="s2">&quot;files.&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">num_days</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Simulated Days&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lob_paths</span><span class="p">):</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Currently simulating </span><span class="si">{</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> ... &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_bin_to_orderqueue</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_one_day</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">lob_paths</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">logTransactions</span><span class="p">:</span>
                <span class="n">transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">transactions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_transactions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_transactions</span><span class="p">())])</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulation finished.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">logTransactions</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">transactions</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">transactions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.run_one_day" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_one_day</span><span class="p">(</span><span class="n">is_last</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Run the simulation for a single day.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>is_last</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, indicates that this is the last iteration of data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="processing-steps" open>
  <summary>Processing Steps</summary>
  <ul>
<li>Execute the simulation for the provided day's data.</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_one_day</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_last</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run the simulation for a single day.</span>

<span class="sd">    Args:</span>
<span class="sd">        is_last (bool): If True, indicates that this is the last iteration of data.</span>

<span class="sd">    Processing Steps:</span>
<span class="sd">        - Execute the simulation for the provided day&#39;s data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">is_last</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.set_stop_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_stop_time</span><span class="p">(</span><span class="n">stop_time</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Set a datetime with millisecond precision to stop the simulation once.</p>
<p>The simulation will stop only once, if the last order added has a submission time
after the stop time. Once the simulation has stopped, the stop time is automatically
cleared, allowing you to set a new one.</p>
<h4 id="bitepy.Simulation.set_stop_time--parameters">Parameters</h4>
<p>stop_time : pd.Timestamp
    A timezone-aware timestamp with millisecond precision when the simulation should stop.
    The simulation will stop if the last processed order's submission time is &gt; this stop time.
verbose : bool, optional
    Whether to print a message when the simulation stops.
Raises</p>
<hr />
<p>ValueError
    If stop_time is not timezone aware.</p>
<h4 id="bitepy.Simulation.set_stop_time--notes">Notes</h4>
<ul>
<li>The stop time is checked after each order is processed</li>
<li>The simulation stops only once per stop time setting</li>
<li>After stopping, the stop time is automatically cleared</li>
<li>You can set a new stop time after the simulation has stopped</li>
<li>The stop time is compared against the order's submission time (transaction time)</li>
</ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_stop_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stop_time</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set a datetime with millisecond precision to stop the simulation once.</span>

<span class="sd">    The simulation will stop only once, if the last order added has a submission time</span>
<span class="sd">    after the stop time. Once the simulation has stopped, the stop time is automatically</span>
<span class="sd">    cleared, allowing you to set a new one.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    stop_time : pd.Timestamp</span>
<span class="sd">        A timezone-aware timestamp with millisecond precision when the simulation should stop.</span>
<span class="sd">        The simulation will stop if the last processed order&#39;s submission time is &gt; this stop time.</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        Whether to print a message when the simulation stops.</span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If stop_time is not timezone aware.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The stop time is checked after each order is processed</span>
<span class="sd">    - The simulation stops only once per stop time setting</span>
<span class="sd">    - After stopping, the stop time is automatically cleared</span>
<span class="sd">    - You can set a new stop time after the simulation has stopped</span>
<span class="sd">    - The stop time is compared against the order&#39;s submission time (transaction time)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if timezone aware</span>
    <span class="k">if</span> <span class="n">stop_time</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;stop_time must be timezone aware&quot;</span><span class="p">)</span>

    <span class="c1"># Convert to UTC</span>
    <span class="n">stop_time_utc</span> <span class="o">=</span> <span class="n">stop_time</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>

    <span class="c1"># Convert to milliseconds since epoch</span>
    <span class="n">stop_time_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stop_time_utc</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="c1"># Call C++ method</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">setStopTime</span><span class="p">(</span><span class="n">stop_time_ms</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.solve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">solve</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Solve the dynamic programming problem once using the time of the last placed order.</p>
<h4 id="bitepy.Simulation.solve--returns">Returns</h4>
<p>pd.DataFrame
    A DataFrame containing the suggested to be executed market orders from the solve.
    Columns include: dp_run, time, last_solve_time, hour, reward,
    reward_incl_deg_costs, volume, type, final_pos, final_stor.</p>
<h4 id="bitepy.Simulation.solve--notes">Notes</h4>
<p>This function calls the C++ solve() method once. It does not run the
full simulation, only performs a single DP solve at the time of the
last placed order. If no orders have been placed yet, the behavior
depends on the initial state of _lastOrder_placementTime.</p>
<h4 id="bitepy.Simulation.solve--example">Example</h4>
<blockquote>
<blockquote>
<blockquote>
<p>orders_df = sim.solve()</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve the dynamic programming problem once using the time of the last placed order.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        A DataFrame containing the suggested to be executed market orders from the solve.</span>
<span class="sd">        Columns include: dp_run, time, last_solve_time, hour, reward,</span>
<span class="sd">        reward_incl_deg_costs, volume, type, final_pos, final_stor.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function calls the C++ solve() method once. It does not run the</span>
<span class="sd">    full simulation, only performs a single DP solve at the time of the</span>
<span class="sd">    last placed order. If no orders have been placed yet, the behavior</span>
<span class="sd">    depends on the initial state of _lastOrder_placementTime.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; orders_df = sim.solve()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Call C++ method (no parameters needed - uses last order placement time)</span>
    <span class="n">order_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

    <span class="c1"># Convert list of dicts to pandas DataFrame</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">order_list</span><span class="p">:</span>
        <span class="c1"># Return empty DataFrame with expected columns</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span>
            <span class="s1">&#39;dp_run&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;last_solve_time&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;reward&#39;</span><span class="p">,</span>
            <span class="s1">&#39;reward_incl_deg_costs&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;final_pos&#39;</span><span class="p">,</span> <span class="s1">&#39;final_stor&#39;</span>
        <span class="p">])</span>

    <span class="n">order_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">order_list</span><span class="p">)</span>
    <span class="n">order_df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">order_df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">order_df</span><span class="p">[</span><span class="s1">&#39;last_solve_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">order_df</span><span class="p">[</span><span class="s1">&#39;last_solve_time&#39;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">order_df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">order_df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">order_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.submit_limit_orders" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">submit_limit_orders</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Submit a list of limit orders and track their matches without battery optimization.</p>
<p>This method validates input data and queues the limit orders for submission at specified times.
The orders will be submitted during the normal simulation run without triggering battery optimization.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A DataFrame containing the limit orders to be submitted.
The DataFrame must have the following columns:
    - transaction_time: The time when the order should be submitted (timezone aware, up to millisecond precision).
    - price: The price of the limit order (/MWh).
    - volume: The volume of the limit order (MWh, positive for buy, negative for sell).
    - side: The side of the order ('buy' or 'sell').
    - delivery_time: The delivery time for the order (timezone aware, required).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="processing-steps" open>
  <summary>Processing Steps</summary>
  <ul>
<li>Validates input data format and required columns.</li>
<li>Ensures timezone awareness and proper formatting of timestamps.</li>
<li>Queues the limit orders for submission during simulation execution.</li>
<li>Orders are processed without triggering battery optimization.</li>
</ul>
</details>

    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>None</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>This method queues orders but does not return match information.
After running the simulation, use get_limit_order_matches() to retrieve match details.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Call this method to queue own limit orders, then run the simulation to process them and collect matches.
Use get_limit_order_matches() after simulation to retrieve final match results.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">submit_limit_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Submit a list of limit orders and track their matches without battery optimization.</span>

<span class="sd">    This method validates input data and queues the limit orders for submission at specified times.</span>
<span class="sd">    The orders will be submitted during the normal simulation run without triggering battery optimization.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): A DataFrame containing the limit orders to be submitted.</span>
<span class="sd">            The DataFrame must have the following columns:</span>
<span class="sd">                - transaction_time: The time when the order should be submitted (timezone aware, up to millisecond precision).</span>
<span class="sd">                - price: The price of the limit order (/MWh).</span>
<span class="sd">                - volume: The volume of the limit order (MWh, positive for buy, negative for sell).</span>
<span class="sd">                - side: The side of the order (&#39;buy&#39; or &#39;sell&#39;).</span>
<span class="sd">                - delivery_time: The delivery time for the order (timezone aware, required).</span>

<span class="sd">    Processing Steps:</span>
<span class="sd">        - Validates input data format and required columns.</span>
<span class="sd">        - Ensures timezone awareness and proper formatting of timestamps.</span>
<span class="sd">        - Queues the limit orders for submission during simulation execution.</span>
<span class="sd">        - Orders are processed without triggering battery optimization.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None: This method queues orders but does not return match information.</span>
<span class="sd">            After running the simulation, use get_limit_order_matches() to retrieve match details.</span>

<span class="sd">    Note:</span>
<span class="sd">        Call this method to queue own limit orders, then run the simulation to process them and collect matches.</span>
<span class="sd">        Use get_limit_order_matches() after simulation to retrieve final match results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Validate input DataFrame</span>
    <span class="n">required_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;transaction_time&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="s1">&#39;delivery_time&#39;</span><span class="p">]</span>
    <span class="n">missing_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">required_columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">missing_columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required columns: </span><span class="si">{</span><span class="n">missing_columns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check if transaction_time is timezone aware</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;transaction_time must be timezone aware&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;transaction_time cannot contain NaT values - all transaction times are required&quot;</span><span class="p">)</span>

    <span class="c1"># Check if delivery_time is timezone aware and has no NaT values</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;delivery_time must be timezone aware&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;delivery_time cannot contain NaT values - all delivery times are required&quot;</span><span class="p">)</span>

    <span class="c1"># check that the delivery time is a full hour exactly</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;delivery_time must be a full hour exactly for hourly products&quot;</span><span class="p">)</span>

    <span class="c1"># volume must be &gt; 0</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;volume must be &gt; 0&quot;</span><span class="p">)</span>

    <span class="c1"># Convert to UTC</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>

    <span class="c1"># Validate side column</span>
    <span class="n">valid_sides</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;buy&#39;</span><span class="p">,</span> <span class="s1">&#39;sell&#39;</span><span class="p">,</span> <span class="s1">&#39;Buy&#39;</span><span class="p">,</span> <span class="s1">&#39;Sell&#39;</span><span class="p">,</span> <span class="s1">&#39;BUY&#39;</span><span class="p">,</span> <span class="s1">&#39;SELL&#39;</span><span class="p">}</span>
    <span class="n">invalid_sides</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;side&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">invalid_sides</span> <span class="o">=</span> <span class="p">[</span><span class="n">side</span> <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="n">invalid_sides</span> <span class="k">if</span> <span class="n">side</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_sides</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">invalid_sides</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid side values: </span><span class="si">{</span><span class="n">invalid_sides</span><span class="si">}</span><span class="s2">. Must be one of: </span><span class="si">{</span><span class="n">valid_sides</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Normalize side values to &#39;Buy&#39;/&#39;Sell&#39;</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;side&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;side&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>

    <span class="c1"># Convert timestamps to ISO format</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Z&#39;</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%SZ&#39;</span><span class="p">)</span>

    <span class="c1"># Prepare data for C++ function</span>
    <span class="n">transaction_times</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;transaction_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">prices</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">volumes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">sides</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;side&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">delivery_times</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1"># Call C++ function to submit limit orders (no return value)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sim_cpp</span><span class="o">.</span><span class="n">submitLimitOrdersAndGetMatches</span><span class="p">(</span><span class="n">transaction_times</span><span class="p">,</span> <span class="n">prices</span><span class="p">,</span> <span class="n">volumes</span><span class="p">,</span> <span class="n">sides</span><span class="p">,</span> <span class="n">delivery_times</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bitepy.Simulation.transform_lob_to_levels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform_lob_to_levels</span><span class="p">(</span><span class="n">lob_state_df</span><span class="p">,</span> <span class="n">exchange</span><span class="o">=</span><span class="s1">&#39;EPEX&#39;</span><span class="p">,</span> <span class="n">product_name</span><span class="o">=</span><span class="s1">&#39;XBID_Hour_Power&#39;</span><span class="p">,</span> <span class="n">delivery_area</span><span class="o">=</span><span class="s1">&#39;10YDE-VE-------2&#39;</span><span class="p">,</span> <span class="n">product_duration_hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Transforms the output of get_limit_order_book_state (individual orders)
into an aggregated, price-level-based DataFrame.</p>
<h4 id="bitepy.Simulation.transform_lob_to_levels--parameters">Parameters</h4>
<p>lob_state_df : pd.DataFrame
    The DataFrame returned by get_limit_order_book_state.
    Must contain columns: 'delivery_time', 'side', 'price', 'volume'.
exchange : str, optional
    Static value for the 'exchange' column in the output.
product_name : str, optional
    Static value for the 'product' column in the output.
delivery_area : str, optional
    Static value for the 'deliveryArea' column in the output.
product_duration_hours : int, optional
    Duration of the product in hours, used to calculate
    deliveryEndUtc from delivery_time (which is used as deliveryStartUtc).
    Default is 1.</p>
<h4 id="bitepy.Simulation.transform_lob_to_levels--returns">Returns</h4>
<p>pd.DataFrame
    A DataFrame in the target format with aggregated price levels and columns:
    ['exchange', 'product', 'deliveryStartUtc', 'deliveryEndUtc',
    'deliveryArea', 'side', 'level', 'price', 'quantity']</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>bitepy/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">transform_lob_to_levels</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">lob_state_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">exchange</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EPEX&quot;</span><span class="p">,</span>
    <span class="n">product_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;XBID_Hour_Power&quot;</span><span class="p">,</span>
    <span class="n">delivery_area</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;10YDE-VE-------2&quot;</span><span class="p">,</span>
    <span class="n">product_duration_hours</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms the output of get_limit_order_book_state (individual orders)</span>
<span class="sd">    into an aggregated, price-level-based DataFrame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lob_state_df : pd.DataFrame</span>
<span class="sd">        The DataFrame returned by get_limit_order_book_state.</span>
<span class="sd">        Must contain columns: &#39;delivery_time&#39;, &#39;side&#39;, &#39;price&#39;, &#39;volume&#39;.</span>
<span class="sd">    exchange : str, optional</span>
<span class="sd">        Static value for the &#39;exchange&#39; column in the output.</span>
<span class="sd">    product_name : str, optional</span>
<span class="sd">        Static value for the &#39;product&#39; column in the output.</span>
<span class="sd">    delivery_area : str, optional</span>
<span class="sd">        Static value for the &#39;deliveryArea&#39; column in the output.</span>
<span class="sd">    product_duration_hours : int, optional</span>
<span class="sd">        Duration of the product in hours, used to calculate</span>
<span class="sd">        deliveryEndUtc from delivery_time (which is used as deliveryStartUtc).</span>
<span class="sd">        Default is 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        A DataFrame in the target format with aggregated price levels and columns:</span>
<span class="sd">        [&#39;exchange&#39;, &#39;product&#39;, &#39;deliveryStartUtc&#39;, &#39;deliveryEndUtc&#39;,</span>
<span class="sd">        &#39;deliveryArea&#39;, &#39;side&#39;, &#39;level&#39;, &#39;price&#39;, &#39;quantity&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Define the target column order</span>
    <span class="n">target_columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;exchange&#39;</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="s1">&#39;deliveryStartUtc&#39;</span><span class="p">,</span> <span class="s1">&#39;deliveryEndUtc&#39;</span><span class="p">,</span>
        <span class="s1">&#39;deliveryArea&#39;</span><span class="p">,</span> <span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;quantity&#39;</span>
    <span class="p">]</span>

    <span class="c1"># Keep only the columns we need from the start</span>
    <span class="n">source_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;delivery_time&#39;</span><span class="p">,</span> <span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">]</span>

    <span class="c1"># Handle empty input DataFrame</span>
    <span class="k">if</span> <span class="n">lob_state_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">target_columns</span><span class="p">)</span>

    <span class="n">all_orders_dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">product_duration</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">product_duration_hours</span><span class="p">)</span>

    <span class="c1"># Group by each product (identified by its delivery_time)</span>
    <span class="k">for</span> <span class="n">delivery_time</span><span class="p">,</span> <span class="n">product_df</span> <span class="ow">in</span> <span class="n">lob_state_df</span><span class="p">[</span><span class="n">source_columns</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;delivery_time&#39;</span><span class="p">):</span>

        <span class="n">delivery_start_utc</span> <span class="o">=</span> <span class="n">delivery_time</span>
        <span class="n">delivery_end_utc</span> <span class="o">=</span> <span class="n">delivery_start_utc</span> <span class="o">+</span> <span class="n">product_duration</span>

        <span class="c1"># --- Process Bids (Source &#39;buy&#39; side) ---</span>
        <span class="n">buys_df</span> <span class="o">=</span> <span class="n">product_df</span><span class="p">[</span><span class="n">product_df</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;buy&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">buys_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># We assume buys_df is already sorted by price (descending)</span>
            <span class="n">bids_1_to_1</span> <span class="o">=</span> <span class="n">buys_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Set level as the order rank</span>
            <span class="n">bids_1_to_1</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bids_1_to_1</span><span class="o">.</span><span class="n">index</span>
            <span class="n">bids_1_to_1</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bid&#39;</span>
            <span class="n">bids_1_to_1</span> <span class="o">=</span> <span class="n">bids_1_to_1</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="s1">&#39;quantity&#39;</span><span class="p">})</span>

            <span class="c1"># Add common metadata</span>
            <span class="n">bids_1_to_1</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exchange</span>
            <span class="n">bids_1_to_1</span><span class="p">[</span><span class="s1">&#39;product&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">product_name</span>
            <span class="n">bids_1_to_1</span><span class="p">[</span><span class="s1">&#39;deliveryStartUtc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delivery_start_utc</span>
            <span class="n">bids_1_to_1</span><span class="p">[</span><span class="s1">&#39;deliveryEndUtc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delivery_end_utc</span>
            <span class="n">bids_1_to_1</span><span class="p">[</span><span class="s1">&#39;deliveryArea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delivery_area</span>

            <span class="n">all_orders_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bids_1_to_1</span><span class="p">[</span><span class="n">target_columns</span><span class="p">])</span> <span class="c1"># Select only target cols</span>

        <span class="c1"># --- Process Asks (Source &#39;sell&#39; side) ---</span>
        <span class="n">sells_df</span> <span class="o">=</span> <span class="n">product_df</span><span class="p">[</span><span class="n">product_df</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sell&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sells_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># We assume sells_df is already sorted by price (ascending)</span>
            <span class="n">asks_1_to_1</span> <span class="o">=</span> <span class="n">sells_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Set level as the order rank</span>
            <span class="n">asks_1_to_1</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">asks_1_to_1</span><span class="o">.</span><span class="n">index</span>
            <span class="n">asks_1_to_1</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ask&#39;</span>
            <span class="n">asks_1_to_1</span> <span class="o">=</span> <span class="n">asks_1_to_1</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="s1">&#39;quantity&#39;</span><span class="p">})</span>

            <span class="c1"># Add common metadata</span>
            <span class="n">asks_1_to_1</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exchange</span>
            <span class="n">asks_1_to_1</span><span class="p">[</span><span class="s1">&#39;product&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">product_name</span>
            <span class="n">asks_1_to_1</span><span class="p">[</span><span class="s1">&#39;deliveryStartUtc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delivery_start_utc</span>
            <span class="n">asks_1_to_1</span><span class="p">[</span><span class="s1">&#39;deliveryEndUtc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delivery_end_utc</span>
            <span class="n">asks_1_to_1</span><span class="p">[</span><span class="s1">&#39;deliveryArea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delivery_area</span>

            <span class="n">all_orders_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asks_1_to_1</span><span class="p">[</span><span class="n">target_columns</span><span class="p">])</span> <span class="c1"># Select only target cols</span>

    <span class="c1"># Handle case where input was not empty but contained no orders</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_orders_dfs</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">target_columns</span><span class="p">)</span>

    <span class="c1"># Combine all products and sides into one DataFrame</span>
    <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_orders_dfs</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">final_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": [], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>